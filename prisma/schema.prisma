// ============================================================================
// PRISMA SCHEMA - E-COMMERCE PLATFORM
// ============================================================================
// Version: 1.0.0
// Database: PostgreSQL 14+
// Description: Comprehensive e-commerce platform with AI/ML, Web3, and advanced features
// ============================================================================

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "fullTextIndex", "jsonProtocol", "metrics", "tracing"]
  binaryTargets   = ["native", "debian-openssl-3.0.x", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  // Enable connection pooling
  relationMode = "prisma"
}

// ============================================================================
// ENUMS - Type Definitions
// ============================================================================

enum Gender {
  MALE
  FEMALE
  OTHER
  PREFER_NOT_TO_SAY
}

enum UserRole {
  USER
  ADMIN
  SELLER
  INFLUENCER
  AFFILIATE
  MODERATOR
  SUPER_ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  BANNED
  PENDING_VERIFICATION
  DELETED
}

enum AddressType {
  HOME
  WORK
  BILLING
  SHIPPING
  OTHER
}

enum OTPType {
  EMAIL_VERIFICATION
  PHONE_VERIFICATION
  TWO_FACTOR_AUTH
  PASSWORD_RESET
  TRANSACTION_VERIFICATION
  LOGIN_VERIFICATION
}

enum NotificationType {
  ORDER_PLACED
  ORDER_CONFIRMED
  ORDER_PROCESSING
  ORDER_SHIPPED
  ORDER_DELIVERED
  ORDER_CANCELLED
  ORDER_RETURNED
  PAYMENT_SUCCESS
  PAYMENT_FAILED
  PAYMENT_PENDING
  PRODUCT_BACK_IN_STOCK
  PRICE_DROP
  PRICE_ALERT
  PROMOTION
  FLASH_SALE
  REVIEW_REQUEST
  REVIEW_REPLY
  WISHLIST_PRICE_DROP
  BADGE_EARNED
  ACHIEVEMENT_UNLOCKED
  LEVEL_UP
  CHALLENGE_COMPLETED
  QUEST_COMPLETED
  REFERRAL_REWARD
  LOYALTY_POINTS_EARNED
  LOYALTY_POINTS_EXPIRING
  NEW_MESSAGE
  LIVE_SESSION_STARTING
  SYSTEM
  SECURITY_ALERT
  CUSTOM
}

// ============================================================================
// CORE USER MODELS
// ============================================================================

model User {
  id        String     @id @default(cuid())
  email     String?    @unique @db.VarChar(255)
  phone     String?    @unique @db.VarChar(20)
  password  String     @db.VarChar(255)
  name      String     @db.VarChar(255)
  avatar    String?    @db.Text
  
  // Profile Information
  bio         String?   @db.Text
  dateOfBirth DateTime? @db.Date
  gender      Gender?
  
  // Preferences
  language String @default("en") @db.VarChar(10)
  currency String @default("INR") @db.VarChar(10)
  timezone String @default("Asia/Kolkata") @db.VarChar(50)
  
  // Status & Verification
  role            UserRole   @default(USER)
  status          UserStatus @default(PENDING_VERIFICATION)
  emailVerified   Boolean    @default(false)
  phoneVerified   Boolean    @default(false)
  emailVerifiedAt DateTime?
  phoneVerifiedAt DateTime?
  
  // Account Management
  isActive     Boolean   @default(true)
  isSuspended  Boolean   @default(false)
  suspendedAt  DateTime?
  suspendedBy  String?   @db.VarChar(50)
  lastLoginAt  DateTime?
  lastLoginIp  String?   @db.VarChar(45)
  
  // Metadata
  metadata  Json?      @db.JsonB
  createdAt DateTime   @default(now()) @db.Timestamptz(3)
  updatedAt DateTime   @updatedAt @db.Timestamptz(3)
  deletedAt DateTime?  @db.Timestamptz(3)

  // ============================================================================
  // RELATIONS - User Related
  // ============================================================================
  
  // Authentication & Security
  sessions            Session[]
  otps                OTP[]
  twoFactorAuth       TwoFactorAuth?
  passwordResetTokens PasswordResetToken[]
  loginAttempts       LoginAttempt[]
  socialConnections   SocialConnection[]
  apiKeys             APIKey[]
  
  // Profile & Addresses
  addresses Address[]
  
  // Shopping & Orders
  cart             Cart?
  wishlist         Wishlist[]
  orders           Order[]
  reviews          Review[]
  productQAs       ProductQA[]
  comparison       Comparison?
  recentlyViewed   RecentlyViewed[]
  viewHistory      ViewHistory[]
  searchHistory    SearchHistory[]
  
  // Notifications
  notifications Notification[]
  
  // Financial
  walletTransactions  WalletTransaction[]
  cryptoPayments      CryptoPayment[]
  giftCardPurchases   GiftCardPurchase[]
  
  // Loyalty & Rewards
  loyaltyPoints   LoyaltyPoints?
  rewardPoints    RewardPoint[]
  vipMembership   VIPMembership?
  
  // Gamification
  gamificationProgress GamificationProgress?
  userBadges           UserBadge[]
  userAchievements     UserAchievement[]
  userChallenges       UserChallenge[]
  userQuests           UserQuest[]
  spinWheelSpins       SpinWheelSpin[]
  
  // Referrals
  referredBy Referral?   @relation("Referred")
  referrals  Referral[]  @relation("Referrer")
  
  // Commerce Features
  preOrders             PreOrder[]
  waitlists             Waitlist[]
  stockAlerts           StockAlert[]
  priceAlerts           PriceAlert[]
  returnRequests        ReturnRequest[]
  subscriptions         Subscription[]
  rentals               Rental[]
  tradeInRequests       TradeInRequest[]
  auctionBids           Bid[]
  productReservations   ProductReservation[]
  installmentPurchases  InstallmentPurchase[]
  
  // Advanced Features
  virtualTryOns           VirtualTryOn[]
  voiceSearches           VoiceSearch[]
  mysteryBoxPurchases     MysteryBoxPurchase[]
  nftOwnerships           NFTOwnership[]
  customizationRequests   CustomizationRequest[]
  carbonOffsets           CarbonOffset[]
  sustainabilityScore     SustainabilityScore?
  insurancePurchases      InsurancePurchase[]
  
  // Social & Content
  socialShares        SocialShare[]
  userStories         UserStory[]
  liveViewers         LiveViewer[]
  chatMessages        ChatMessage[]
  pollVotes           PollVote[]
  blogComments        BlogComment[]
  
  // Seller & Business
  sellerProfile      Seller?
  adminProfile       Admin?
  influencerProfile  InfluencerProfile?
  affiliateProfile   AffiliateProfile?
  
  // Groups & Registry
  groupMemberships       GroupMember[]
  createdGroups          ShoppingGroup[]        @relation("GroupCreator")
  registries             Registry[]
  registryContributions  RegistryContribution[]
  
  // Support & Disputes
  disputes           Dispute[]
  disputeMessages    DisputeMessage[]
  appFeedback        AppFeedback[]
  contactMessages    ContactMessage[]
  
  // Device & Platform
  mobileDevices          MobileDevice[]
  desktopAppSessions     DesktopAppSession[]
  browserExtensionUsers  BrowserExtensionUser[]
  pushTokens             PushToken[]
  
  // AI & Personalization
  aiRecommendations         AIRecommendation[]
  personalShopperSessions   PersonalShopperSession[]
  imageRecognitions         ImageRecognition[]
  
  // Web3
  tokenStakings    TokenStaking[]
  governanceTokens GovernanceToken[]
  daoProposals     DAOProposal[]
  daoVotes         DAOVote[]
  
  // Live Commerce
  liveSessions LiveSession[]

  @@index([email])
  @@index([phone])
  @@index([role])
  @@index([status])
  @@index([createdAt(sort: Desc)])
  @@index([emailVerified, phoneVerified])
  @@index([lastLoginAt(sort: Desc)])
  @@index([deletedAt])
  @@fulltext([name, email])
  
  @@map("users")
}

// ============================================================================
// AUTHENTICATION & SECURITY
// ============================================================================

model Session {
  id           String  @id @default(cuid())
  userId       String
  token        String  @unique @db.VarChar(500)
  refreshToken String? @unique @db.VarChar(500)
  
  // Device Information
  deviceId     String?  @db.VarChar(255)
  deviceName   String?  @db.VarChar(255)
  deviceType   String?  @db.VarChar(50)
  browser      String?  @db.VarChar(100)
  os           String?  @db.VarChar(100)
  ipAddress    String?  @db.VarChar(45)
  userAgent    String?  @db.Text
  
  // Location
  country   String? @db.VarChar(100)
  city      String? @db.VarChar(100)
  region    String? @db.VarChar(100)
  latitude  Float?  @db.DoublePrecision
  longitude Float?  @db.DoublePrecision
  
  // Status
  isActive     Boolean  @default(true)
  isTrusted    Boolean  @default(false)
  lastActivity DateTime @default(now()) @db.Timestamptz(3)
  expiresAt    DateTime @db.Timestamptz(3)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([refreshToken])
  @@index([expiresAt])
  @@index([isActive])
  @@index([deviceId])
  @@index([lastActivity(sort: Desc)])
  
  @@map("sessions")
}

model OTP {
  id      String  @id @default(cuid())
  userId  String
  code    String  @db.VarChar(10)
  type    OTPType
  purpose String? @db.VarChar(255)
  
  // Verification
  verified   Boolean   @default(false)
  verifiedAt DateTime? @db.Timestamptz(3)
  
  // Security
  attempts    Int     @default(0)
  maxAttempts Int     @default(3)
  ipAddress   String? @db.VarChar(45)
  
  // Expiry
  expiresAt DateTime @db.Timestamptz(3)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([code])
  @@index([type])
  @@index([expiresAt])
  @@index([verified])
  
  @@map("otps")
}

model TwoFactorAuth {
  id          String  @id @default(cuid())
  userId      String  @unique
  secret      String  @db.VarChar(500)
  backupCodes String[] @db.VarChar(20)
  method      String  @default("TOTP") @db.VarChar(20)
  
  // Status
  isEnabled Boolean   @default(false)
  enabledAt DateTime? @db.Timestamptz(3)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([userId])
  @@index([isEnabled])
  
  @@map("two_factor_auth")
}

model PasswordResetToken {
  id        String  @id @default(cuid())
  userId    String
  token     String  @unique @db.VarChar(500)
  ipAddress String? @db.VarChar(45)
  userAgent String? @db.Text
  
  // Status
  used   Boolean   @default(false)
  usedAt DateTime? @db.Timestamptz(3)
  
  // Expiry
  expiresAt DateTime @db.Timestamptz(3)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
  @@index([expiresAt])
  @@index([used])
  
  @@map("password_reset_tokens")
}

model LoginAttempt {
  id     String  @id @default(cuid())
  userId String?
  email  String? @db.VarChar(255)
  phone  String? @db.VarChar(20)
  
  // Result
  success    Boolean @default(false)
  failReason String? @db.Text
  
  // Device & Location
  ipAddress String? @db.VarChar(45)
  userAgent String? @db.Text
  deviceId  String? @db.VarChar(255)
  country   String? @db.VarChar(100)
  city      String? @db.VarChar(100)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([userId])
  @@index([email])
  @@index([phone])
  @@index([ipAddress])
  @@index([success])
  @@index([createdAt(sort: Desc)])
  
  @@map("login_attempts")
}

model SocialConnection {
  id       String @id @default(cuid())
  userId   String
  provider String @db.VarChar(50)
  
  // Provider Data
  providerId   String  @db.VarChar(255)
  accessToken  String? @db.Text
  refreshToken String? @db.Text
  expiresAt    DateTime? @db.Timestamptz(3)
  
  // Profile
  profile Json? @db.JsonB
  
  // Status
  isConnected Boolean @default(true)
  
  // Timestamps
  connectedAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt   DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, provider])
  @@index([userId])
  @@index([provider])
  @@index([providerId])
  
  @@map("social_connections")
}

// ============================================================================
// ADDRESS MODEL
// ============================================================================

model Address {
  id     String      @id @default(cuid())
  userId String
  type   AddressType @default(HOME)
  
  // Contact Details
  label          String? @db.VarChar(100)
  fullName       String  @db.VarChar(255)
  phone          String  @db.VarChar(20)
  alternatePhone String? @db.VarChar(20)
  email          String? @db.VarChar(255)
  
  // Address
  addressLine1 String  @db.VarChar(500)
  addressLine2 String? @db.VarChar(500)
  landmark     String? @db.VarChar(255)
  city         String  @db.VarChar(100)
  district     String? @db.VarChar(100)
  state        String  @db.VarChar(100)
  zipCode      String  @db.VarChar(20)
  country      String  @default("India") @db.VarChar(100)
  
  // Geolocation
  latitude  Float?  @db.DoublePrecision
  longitude Float?  @db.DoublePrecision
  placeId   String? @db.VarChar(255)
  
  // Status
  isDefault  Boolean @default(false)
  isVerified Boolean @default(false)
  verifiedAt DateTime? @db.Timestamptz(3)
  
  // Instructions
  instructions String? @db.Text
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([isDefault])
  @@index([zipCode])
  @@index([city])
  @@index([state])
  
  @@map("addresses")
}// ============================================================================
// ADMIN & SELLER MODELS
// ============================================================================

model Admin {
  id     String @id @default(cuid())
  userId String @unique
  
  // Store Information
  storeName        String  @db.VarChar(255)
  storeUrl         String? @unique @db.VarChar(255)
  storeDescription String? @db.Text
  storeLogo        String? @db.Text
  storeBanner      String? @db.Text
  
  // Verification
  isVerified Boolean @default(false)
  verifiedAt DateTime? @db.Timestamptz(3)
  verifiedBy String? @db.VarChar(50)
  
  // Business Details
  businessName    String? @db.VarChar(255)
  taxId           String? @db.VarChar(100)
  businessLicense String? @db.Text
  
  // Financial
  commission  Float @default(10.0) @db.DoublePrecision
  totalSales  Float @default(0) @db.DoublePrecision
  totalOrders Int   @default(0)
  
  // Banking
  bankDetails    Json? @db.JsonB
  payoutSchedule String @default("WEEKLY") @db.VarChar(20)
  
  // Performance
  rating      Float @default(0) @db.DoublePrecision
  reviewCount Int   @default(0)
  
  // Metadata
  metadata  Json? @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  products Product[]
  orders   Order[]
  coupons  Coupon[]

  @@index([userId])
  @@index([storeUrl])
  @@index([isVerified])
  @@index([rating(sort: Desc)])
  @@index([totalSales(sort: Desc)])
  @@fulltext([storeName, storeDescription])
  
  @@map("admins")
}

model Seller {
  id     String @id @default(cuid())
  userId String @unique
  
  // Business Information
  businessName String  @db.VarChar(255)
  businessType String? @db.VarChar(100)
  
  // Tax & Legal
  gstNumber String? @unique @db.VarChar(50)
  panNumber String? @unique @db.VarChar(50)
  
  // Addresses
  businessAddress Json  @db.JsonB
  pickupAddress   Json? @db.JsonB
  returnAddress   Json? @db.JsonB
  
  // Verification
  isVerified       Boolean  @default(false)
  verificationDocs String[] @db.Text
  verifiedAt       DateTime? @db.Timestamptz(3)
  verifiedBy       String?  @db.VarChar(50)
  
  // Financial
  commission   Float @default(15.0) @db.DoublePrecision
  totalRevenue Float @default(0) @db.DoublePrecision
  
  // Performance Metrics
  totalProducts    Int   @default(0)
  rating           Float @default(0) @db.DoublePrecision
  responseTime     Int?  // in minutes
  fulfillmentRate  Float @default(0) @db.DoublePrecision
  cancellationRate Float @default(0) @db.DoublePrecision
  
  // Status
  accountStatus String @default("PENDING") @db.VarChar(50)
  
  // Metadata
  metadata  Json?    @db.JsonB
  joinedAt  DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user               User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  sellerVerification SellerVerification?

  @@index([userId])
  @@index([isVerified])
  @@index([accountStatus])
  @@index([rating(sort: Desc)])
  @@index([gstNumber])
  @@index([panNumber])
  @@fulltext([businessName])
  
  @@map("sellers")
}

model SellerVerification {
  id       String @id @default(cuid())
  sellerId String @unique
  
  // Document Information
  documentType   String   @db.VarChar(100)
  documentNumber String   @db.VarChar(255)
  documentImages String[] @db.Text
  
  // Status
  status          String    @default("PENDING") @db.VarChar(50)
  verifiedBy      String?   @db.VarChar(50)
  verifiedAt      DateTime? @db.Timestamptz(3)
  rejectionReason String?   @db.Text
  notes           String?   @db.Text
  
  // Expiry
  expiryDate DateTime? @db.Date
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  seller Seller @relation(fields: [sellerId], references: [id], onDelete: Cascade)

  @@index([sellerId])
  @@index([status])
  @@index([documentType])
  @@index([expiryDate])
  
  @@map("seller_verifications")
}

// ============================================================================
// CATEGORY MODEL
// ============================================================================

model Category {
  id          String  @id @default(cuid())
  name        String  @unique @db.VarChar(255)
  slug        String  @unique @db.VarChar(255)
  description String? @db.Text
  
  // Media
  image  String? @db.Text
  icon   String? @db.Text
  banner String? @db.Text
  
  // Hierarchy
  parentId String?
  level    Int     @default(0)
  path     String? @db.VarChar(500) // e.g., "electronics/mobile/smartphones"
  
  // Status & Features
  isActive   Boolean @default(true)
  isFeatured Boolean @default(false)
  sortOrder  Int     @default(0)
  
  // Statistics
  productCount Int @default(0)
  
  // SEO
  metaTitle       String?  @db.VarChar(255)
  metaDescription String?  @db.Text
  metaKeywords    String[] @db.VarChar(100)
  seoScore        Float?   @db.DoublePrecision
  
  // Custom Attributes
  customAttributes Json? @db.JsonB
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  parent   Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: SetNull)
  children Category[] @relation("CategoryHierarchy")
  products Product[]

  @@index([slug])
  @@index([parentId])
  @@index([isActive])
  @@index([isFeatured])
  @@index([sortOrder])
  @@index([level])
  @@index([productCount(sort: Desc)])
  @@fulltext([name, description])
  
  @@map("categories")
}

// ============================================================================
// BRAND MODEL
// ============================================================================

model Brand {
  id          String  @id @default(cuid())
  name        String  @unique @db.VarChar(255)
  slug        String  @unique @db.VarChar(255)
  description String? @db.Text
  
  // Media
  logo   String? @db.Text
  banner String? @db.Text
  
  // Contact
  website String? @db.VarChar(500)
  email   String? @db.VarChar(255)
  phone   String? @db.VarChar(20)
  
  // Status
  isActive   Boolean @default(true)
  isFeatured Boolean @default(false)
  
  // Statistics
  productCount Int @default(0)
  
  // SEO
  metaTitle       String?  @db.VarChar(255)
  metaDescription String?  @db.Text
  metaKeywords    String[] @db.VarChar(100)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([slug])
  @@index([isActive])
  @@index([isFeatured])
  @@index([productCount(sort: Desc)])
  @@fulltext([name, description])
  
  @@map("brands")
}

// ============================================================================
// PRODUCT MODEL - Main Product Entity
// ============================================================================

enum ProductStatus {
  DRAFT
  PENDING_REVIEW
  APPROVED
  PUBLISHED
  UNPUBLISHED
  OUT_OF_STOCK
  DISCONTINUED
  ARCHIVED
}

model Product {
  id               String        @id @default(cuid())
  title            String        @db.VarChar(500)
  slug             String        @unique @db.VarChar(500)
  description      String        @db.Text
  shortDescription String?       @db.VarChar(1000)
  
  // Categories & Classification
  categoryId String
  brandId    String?
  brand      String? @db.VarChar(255)
  
  // Identifiers
  sku                String? @unique @db.VarChar(100)
  barcode            String? @unique @db.VarChar(100)
  upc                String? @unique @db.VarChar(100)
  isbn               String? @unique @db.VarChar(50)
  manufacturerPartNumber String? @db.VarChar(100)
  
  // Pricing
  price         Float  @db.DoublePrecision
  comparePrice  Float? @db.DoublePrecision
  costPrice     Float? @db.DoublePrecision
  profitMargin  Float? @db.DoublePrecision
  taxRate       Float  @default(0) @db.DoublePrecision
  
  // Inventory
  stock             Int       @default(0)
  lowStockThreshold Int       @default(10)
  restockDate       DateTime? @db.Timestamptz(3)
  
  // Physical Attributes
  weight        Float?  @db.DoublePrecision
  weightUnit    String? @default("kg") @db.VarChar(10)
  length        Float?  @db.DoublePrecision
  width         Float?  @db.DoublePrecision
  height        Float?  @db.DoublePrecision
  dimensionUnit String? @default("cm") @db.VarChar(10)
  
  // Media
  images    String[] @db.Text
  videos    String[] @db.Text
  thumbnail String?  @db.Text
  
  // Variants & Options
  hasVariants Boolean  @default(false)
  color       String[] @db.VarChar(50)
  size        String[] @db.VarChar(50)
  material    String?  @db.VarChar(255)
  
  // Product Details
  features       String[] @db.Text
  specifications Json?    @db.JsonB
  tags           String[] @db.VarChar(100)
  keywords       String[] @db.VarChar(100)
  
  // Manufacturer & Origin
  manufacturer String? @db.VarChar(255)
  origin       String? @db.VarChar(100)
  madeIn       String? @db.VarChar(100)
  
  // Marketing Flags
  isNew            Boolean @default(false)
  isFeatured       Boolean @default(false)
  isTrending       Boolean @default(false)
  isBestSeller     Boolean @default(false)
  isExclusive      Boolean @default(false)
  isLimitedEdition Boolean @default(false)
  
  // Discount
  discountPercentage Float @default(0) @db.DoublePrecision
  discountStartDate  DateTime? @db.Timestamptz(3)
  discountEndDate    DateTime? @db.Timestamptz(3)
  
  // Ratings & Engagement
  rating        Float @default(0) @db.DoublePrecision
  reviewCount   Int   @default(0)
  viewCount     Int   @default(0)
  soldCount     Int   @default(0)
  wishlistCount Int   @default(0)
  shareCount    Int   @default(0)
  
  // Performance Metrics
  conversionRate Float @default(0) @db.DoublePrecision
  returnRate     Float @default(0) @db.DoublePrecision
  clickRate      Float @default(0) @db.DoublePrecision
  
  // Publishing
  status      ProductStatus @default(DRAFT)
  isActive    Boolean       @default(false)
  isPublished Boolean       @default(false)
  publishedAt DateTime?     @db.Timestamptz(3)
  
  // Ordering
  unitsPerPackage  Int  @default(1)
  minOrderQuantity Int  @default(1)
  maxOrderQuantity Int?
  
  // Warranty & Returns
  warrantyPeriod Int?    @default(0) // in days
  warrantyType   String? @db.VarChar(100)
  returnWindow   Int?    @default(30) // in days
  returnPolicy   String? @db.Text
  
  // Shipping
  shippingClass  String? @db.VarChar(100)
  freeShipping   Boolean @default(false)
  shippingWeight Float?  @db.DoublePrecision
  
  // Tax & Compliance
  taxClass       String? @db.VarChar(100)
  hsn            String? @db.VarChar(50) // HSN Code for GST
  isDigital      Boolean @default(false)
  requiresShipping Boolean @default(true)
  
  // SEO
  metaTitle       String?  @db.VarChar(255)
  metaDescription String?  @db.VarChar(500)
  metaKeywords    String[] @db.VarChar(100)
  canonicalUrl    String?  @db.VarChar(500)
  structuredData  Json?    @db.JsonB
  seoScore        Float?   @db.DoublePrecision
  
  // Quality & Sustainability
  qualityScore        Float?   @db.DoublePrecision
  sustainabilityScore Float?   @db.DoublePrecision
  carbonFootprint     Float?   @db.DoublePrecision
  recyclable          Boolean  @default(false)
  energyRating        String?  @db.VarChar(10)
  certifications      String[] @db.VarChar(100)
  
  // Food & Consumables (if applicable)
  allergens     String[] @db.VarChar(100)
  ingredients   String[] @db.Text
  nutritionInfo Json?    @db.JsonB
  expiryDate    DateTime? @db.Date
  batchNumber   String?  @db.VarChar(100)
  
  // Ownership
  adminId  String
  sellerId String?
  
  // Metadata
  customFields Json?    @db.JsonB
  metadata     Json?    @db.JsonB
  createdAt    DateTime @default(now()) @db.Timestamptz(3)
  updatedAt    DateTime @updatedAt @db.Timestamptz(3)
  deletedAt    DateTime? @db.Timestamptz(3)
  
  // ============================================================================
  // RELATIONS - Product Related
  // ============================================================================
  
  // Ownership
  admin    Admin   @relation(fields: [adminId], references: [id], onDelete: Cascade)
  category Category @relation(fields: [categoryId], references: [id])
  
  // Variants & Customization
  variants       ProductVariant[]
  customizations ProductCustomization[]
  
  // Bundles & Related
  bundleItems    ProductBundle[] @relation("MainProduct")
  bundledIn      ProductBundle[] @relation("BundleProducts")
  relatedFrom    RelatedProduct[] @relation("MainProduct")
  relatedTo      RelatedProduct[] @relation("RelatedProducts")
  
  // Reviews & Questions
  reviews    Review[]
  productQAs ProductQA[]
  questions  ProductQuestion[]
  
  // Shopping
  cartItems        CartItem[]
  wishlist         Wishlist[]
  comparison       ComparisonItem[]
  recentlyViewed   RecentlyViewed[]
  viewHistory      ViewHistory[]
  
  // Orders
  orderItems OrderItem[]
  
  // Inventory & Alerts
  stockAlerts        StockAlert[]
  stockNotifications StockNotification[]
  priceAlerts        PriceAlert[]
  inventoryLogs      InventoryLog[]
  warehouseInventory WarehouseInventory[]
  stockMovements     StockMovement[]
  priceHistory       PriceHistory[]
  
  // Promotions
  flashSales   FlashSaleProduct[]
  dealOfTheDay DealOfTheDay[]
  bulkPricing  BulkPricing[]
  
  // Advanced Commerce
  subscriptionPlans  SubscriptionPlan[]
  preOrders          PreOrder[]
  waitlists          Waitlist[]
  reservations       ProductReservation[]
  rentalProducts     RentalProduct[]
  productInsurance   ProductInsurance[]
  availabilityCalendar AvailabilityCalendar[]
  
  // Auctions & Mystery Boxes
  auctions       Auction[]
  mysteryBoxItems MysteryBoxItem[]
  
  // AR/VR & Media
  ar3DModels     AR3DModel[]
  virtualTryOns  VirtualTryOn[]
  videoContents  VideoContentProduct[]
  
  // Social & Marketing
  socialShares  SocialShare[]
  influencerCampaigns InfluencerCampaignProduct[]
  
  // AI & Recommendations
  aiRecommendations AIRecommendation[]
  productTagging    ProductTagging[]
  searchRelevance   SearchRelevance[]
  
  // Web3
  nftCertificates NFTCertificate[]

  @@index([slug])
  @@index([categoryId, status, isPublished])
  @@index([adminId])
  @@index([sellerId])
  @@index([brandId])
  @@index([brand])
  @@index([status])
  @@index([isActive, isPublished])
  @@index([isFeatured])
  @@index([isTrending])
  @@index([isBestSeller])
  @@index([createdAt(sort: Desc)])
  @@index([publishedAt(sort: Desc)])
  @@index([price])
  @@index([rating(sort: Desc)])
  @@index([soldCount(sort: Desc)])
  @@index([viewCount(sort: Desc)])
  @@index([price, rating])
  @@index([brand, categoryId])
  @@index([sku])
  @@index([barcode])
  @@index([stock])
  @@index([deletedAt])
  @@fulltext([title, description, keywords])
  
  @@map("products")
}

// ============================================================================
// PRODUCT VARIANT MODEL
// ============================================================================

model ProductVariant {
  id        String @id @default(cuid())
  productId String
  name      String @db.VarChar(255)
  
  // Identifiers
  sku     String? @unique @db.VarChar(100)
  barcode String? @unique @db.VarChar(100)
  
  // Pricing
  price         Float? @db.DoublePrecision
  comparePrice  Float? @db.DoublePrecision
  costPrice     Float? @db.DoublePrecision
  
  // Inventory
  stock         Int     @default(0)
  lowStockAlert Int?    @default(5)
  trackInventory Boolean @default(true)
  
  // Attributes (color, size, etc.)
  attributes Json @db.JsonB
  
  // Media
  image  String?  @db.Text
  images String[] @db.Text
  
  // Physical
  weight     Float? @db.DoublePrecision
  length     Float? @db.DoublePrecision
  width      Float? @db.DoublePrecision
  height     Float? @db.DoublePrecision
  
  // Status
  isDefault Boolean @default(false)
  isActive  Boolean @default(true)
  sortOrder Int     @default(0)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([sku])
  @@index([barcode])
  @@index([isActive])
  @@index([isDefault])
  @@index([stock])
  
  @@map("product_variants")
}

// ============================================================================
// PRODUCT BUNDLE MODEL
// ============================================================================

model ProductBundle {
  id              String @id @default(cuid())
  mainProductId   String
  bundleProductId String
  
  // Bundle Configuration
  quantity        Int   @default(1)
  discount        Float @default(0) @db.DoublePrecision
  discountType    String @default("PERCENTAGE") @db.VarChar(20)
  
  // Pricing
  bundlePrice     Float? @db.DoublePrecision
  
  // Status
  isActive        Boolean @default(true)
  sortOrder       Int     @default(0)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  mainProduct   Product @relation("MainProduct", fields: [mainProductId], references: [id], onDelete: Cascade)
  bundleProduct Product @relation("BundleProducts", fields: [bundleProductId], references: [id], onDelete: Cascade)

  @@unique([mainProductId, bundleProductId])
  @@index([mainProductId])
  @@index([bundleProductId])
  @@index([isActive])
  
  @@map("product_bundles")
}

// ============================================================================
// RELATED PRODUCTS MODEL
// ============================================================================

model RelatedProduct {
  id               String @id @default(cuid())
  mainProductId    String
  relatedProductId String
  
  // Relation Type
  relationType String @default("SIMILAR") @db.VarChar(50) // SIMILAR, COMPLEMENTARY, ALTERNATIVE, FREQUENTLY_BOUGHT_TOGETHER
  
  // AI/Manual
  source String @default("MANUAL") @db.VarChar(50) // MANUAL, AI, COLLABORATIVE_FILTERING
  score  Float  @default(0) @db.DoublePrecision
  
  // Status
  isActive  Boolean @default(true)
  sortOrder Int     @default(0)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  mainProduct    Product @relation("MainProduct", fields: [mainProductId], references: [id], onDelete: Cascade)
  relatedProduct Product @relation("RelatedProducts", fields: [relatedProductId], references: [id], onDelete: Cascade)

  @@unique([mainProductId, relatedProductId])
  @@index([mainProductId])
  @@index([relatedProductId])
  @@index([relationType])
  @@index([score(sort: Desc)])
  
  @@map("related_products")
}

// ============================================================================
// PRODUCT CUSTOMIZATION MODEL
// ============================================================================

enum CustomizationType {
  TEXT
  IMAGE
  COLOR
  SIZE
  MATERIAL
  ENGRAVING
  EMBROIDERY
  MONOGRAM
  UPLOAD
  DROPDOWN
  RADIO
  CHECKBOX
  DATE
  TIME
}

model ProductCustomization {
  id        String            @id @default(cuid())
  productId String
  name      String            @db.VarChar(255)
  label     String            @db.VarChar(255)
  type      CustomizationType
  
  // Configuration
  options       Json    @db.JsonB
  priceModifier Float   @default(0) @db.DoublePrecision
  priceType     String  @default("FIXED") @db.VarChar(20) // FIXED, PERCENTAGE
  
  // Validation
  isRequired Boolean @default(false)
  minLength  Int?
  maxLength  Int?
  minValue   Float?  @db.DoublePrecision
  maxValue   Float?  @db.DoublePrecision
  pattern    String? @db.VarChar(500) // Regex pattern
  validations Json?  @db.JsonB
  
  // Display
  placeholder   String? @db.VarChar(255)
  helpText      String? @db.Text
  defaultValue  String? @db.VarChar(500)
  sortOrder     Int     @default(0)
  
  // Status
  isActive Boolean @default(true)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([type])
  @@index([isActive])
  @@index([sortOrder])
  
  @@map("product_customizations")
}// ============================================================================
// CART & WISHLIST MODELS
// ============================================================================

model Cart {
  id        String @id @default(cuid())
  userId    String @unique
  sessionId String? @db.VarChar(255)
  
  // Pricing
  subtotal Float @default(0) @db.DoublePrecision
  tax      Float @default(0) @db.DoublePrecision
  discount Float @default(0) @db.DoublePrecision
  total    Float @default(0) @db.DoublePrecision
  
  // Coupon
  couponCode     String? @db.VarChar(100)
  couponDiscount Float   @default(0) @db.DoublePrecision
  
  // Loyalty
  loyaltyPointsUsed Int   @default(0)
  loyaltyDiscount   Float @default(0) @db.DoublePrecision
  
  // Status
  isAbandoned  Boolean   @default(false)
  abandonedAt  DateTime? @db.Timestamptz(3)
  
  // Expiry
  expiresAt    DateTime? @db.Timestamptz(3)
  lastActivity DateTime  @default(now()) @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user  User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  items CartItem[]

  @@index([userId])
  @@index([sessionId])
  @@index([expiresAt])
  @@index([lastActivity(sort: Desc)])
  @@index([isAbandoned])
  
  @@map("carts")
}

model CartItem {
  id     String  @id @default(cuid())
  cartId String
  productId String
  variantId String? @db.VarChar(50)
  
  // Product Info (denormalized for performance)
  productName  String  @db.VarChar(500)
  productSlug  String? @db.VarChar(500)
  productImage String? @db.Text
  sku          String? @db.VarChar(100)
  
  // Quantity & Pricing
  quantity Int   @default(1)
  price    Float @db.DoublePrecision
  
  // Discount
  discount      Float @default(0) @db.DoublePrecision
  discountType  String? @db.VarChar(20)
  
  // Calculated
  total Float @db.DoublePrecision
  
  // Customization
  customization Json? @db.JsonB
  variantInfo   Json? @db.JsonB
  
  // Gift Options
  isGift      Boolean @default(false)
  giftWrap    Boolean @default(false)
  giftMessage String? @db.Text
  giftWrapFee Float   @default(0) @db.DoublePrecision
  
  // Notes
  notes String? @db.Text
  
  // Status
  savedForLater Boolean @default(false)
  isAvailable   Boolean @default(true)
  
  // Timestamps
  addedAt   DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  cart    Cart    @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([cartId, productId, variantId])
  @@index([cartId])
  @@index([productId])
  @@index([variantId])
  @@index([savedForLater])
  
  @@map("cart_items")
}

model Wishlist {
  id        String  @id @default(cuid())
  userId    String
  productId String
  variantId String? @db.VarChar(50)
  
  // Product Info (denormalized)
  productName  String  @db.VarChar(500)
  productImage String? @db.Text
  currentPrice Float   @db.DoublePrecision
  
  // Settings
  notes       String? @db.Text
  priority    Int     @default(0)
  isPublic    Boolean @default(false)
  
  // Notifications
  notifyPrice Boolean @default(false)
  notifyStock Boolean @default(false)
  targetPrice Float?  @db.DoublePrecision
  
  // Collection/List
  collectionName String? @db.VarChar(255)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId, variantId])
  @@index([userId])
  @@index([productId])
  @@index([isPublic])
  @@index([priority(sort: Desc)])
  @@index([collectionName])
  @@index([createdAt(sort: Desc)])
  
  @@map("wishlists")
}

model Comparison {
  id         String   @id @default(cuid())
  userId     String   @unique
  categoryId String?  @db.VarChar(50)
  maxItems   Int      @default(4)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user  User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  items ComparisonItem[]

  @@index([userId])
  @@index([categoryId])
  
  @@map("comparisons")
}

model ComparisonItem {
  id           String @id @default(cuid())
  comparisonId String
  productId    String
  
  // Position
  position Int @default(0)
  
  // Timestamps
  addedAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  comparison Comparison @relation(fields: [comparisonId], references: [id], onDelete: Cascade)
  product    Product    @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([comparisonId, productId])
  @@index([comparisonId])
  @@index([productId])
  
  @@map("comparison_items")
}

// ============================================================================
// ORDER MODELS
// ============================================================================

enum OrderStatus {
  PENDING
  PAYMENT_PENDING
  PAYMENT_FAILED
  CONFIRMED
  PROCESSING
  PACKED
  READY_TO_SHIP
  SHIPPED
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  CANCELLED
  CANCEL_REQUESTED
  RETURNED
  RETURN_REQUESTED
  REFUNDED
  PARTIALLY_REFUNDED
  FAILED
  ON_HOLD
}

enum PaymentStatus {
  PENDING
  PROCESSING
  AUTHORIZED
  CAPTURED
  COMPLETED
  FAILED
  DECLINED
  REFUNDED
  PARTIALLY_REFUNDED
  CANCELLED
  EXPIRED
  DISPUTED
  CHARGEBACK
}

enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  UPI
  NET_BANKING
  WALLET
  COD
  EMI
  BNPL
  CRYPTO
  GIFT_CARD
  STORE_CREDIT
  PAYPAL
  STRIPE
  RAZORPAY
  PHONEPE
  GOOGLEPAY
  PAYTM
  BANK_TRANSFER
}

enum RefundStatus {
  PENDING
  PROCESSING
  INITIATED
  COMPLETED
  REJECTED
  CANCELLED
  FAILED
}

enum FulfillmentStatus {
  UNFULFILLED
  PARTIALLY_FULFILLED
  FULFILLED
  RESTOCKED
  CANCELLED
}

model Order {
  id          String      @id @default(cuid())
  orderNumber String      @unique @db.VarChar(50)
  userId      String
  adminId     String
  sellerId    String?     @db.VarChar(50)
  
  // Customer Information
  userEmail String  @db.VarChar(255)
  userName  String  @db.VarChar(255)
  userPhone String? @db.VarChar(20)
  
  // Addresses (stored as JSON for flexibility)
  shippingAddress Json  @db.JsonB
  billingAddress  Json? @db.JsonB
  
  // Pricing Breakdown
  subtotal       Float @db.DoublePrecision
  shippingCost   Float @default(0) @db.DoublePrecision
  tax            Float @default(0) @db.DoublePrecision
  discount       Float @default(0) @db.DoublePrecision
  totalAmount    Float @db.DoublePrecision
  
  // Tax Details
  taxBreakdown Json? @db.JsonB
  gstNumber    String? @db.VarChar(50)
  
  // Discounts & Offers
  couponCode       String? @db.VarChar(100)
  couponDiscount   Float   @default(0) @db.DoublePrecision
  
  // Loyalty & Credits
  loyaltyPointsUsed Int   @default(0)
  loyaltyDiscount   Float @default(0) @db.DoublePrecision
  giftCardCode      String? @db.VarChar(50)
  giftCardDiscount  Float   @default(0) @db.DoublePrecision
  storeCreditUsed   Float   @default(0) @db.DoublePrecision
  
  // Currency
  currency     String @default("INR") @db.VarChar(10)
  exchangeRate Float  @default(1.0) @db.DoublePrecision
  
  // Payment Information
  paymentMethod   PaymentMethod
  paymentStatus   PaymentStatus  @default(PENDING)
  paymentGateway  String?        @db.VarChar(100)
  transactionId   String?        @db.VarChar(255)
  paymentResponse Json?          @db.JsonB
  
  // Order Status
  status            OrderStatus       @default(PENDING)
  fulfillmentStatus FulfillmentStatus @default(UNFULFILLED)
  
  // Shipping Information
  shippingMethod   String?   @db.VarChar(100)
  shippingProvider String?   @db.VarChar(100)
  trackingNumber   String?   @db.VarChar(255)
  trackingUrl      String?   @db.Text
  shippingLabel    String?   @db.Text
  
  // Delivery Estimates
  estimatedDelivery DateTime? @db.Timestamptz(3)
  expectedDelivery  DateTime? @db.Timestamptz(3)
  
  // Important Dates
  shippedAt    DateTime? @db.Timestamptz(3)
  deliveredAt  DateTime? @db.Timestamptz(3)
  
  // Cancellation
  cancelledAt        DateTime? @db.Timestamptz(3)
  cancellationReason String?   @db.Text
  cancelledBy        String?   @db.VarChar(50) // USER, ADMIN, SYSTEM
  
  // Refund
  refundAmount Float?        @default(0) @db.DoublePrecision
  refundStatus RefundStatus?
  refundedAt   DateTime?     @db.Timestamptz(3)
  refundReason String?       @db.Text
  
  // Notes & Messages
  notes          String? @db.Text
  internalNotes  String? @db.Text
  customerNotes  String? @db.Text
  adminNotes     String? @db.Text
  
  // Gift Options
  isGift       Boolean @default(false)
  giftMessage  String? @db.Text
  giftWrapCost Float   @default(0) @db.DoublePrecision
  
  // Additional Charges
  insuranceCost Float @default(0) @db.DoublePrecision
  handlingFee   Float @default(0) @db.DoublePrecision
  codCharges    Float @default(0) @db.DoublePrecision
  
  // Tracking & Analytics
  ipAddress    String? @db.VarChar(45)
  userAgent    String? @db.Text
  deviceType   String? @db.VarChar(50)
  source       String? @db.VarChar(100)
  medium       String? @db.VarChar(100)
  campaign     String? @db.VarChar(100)
  referrer     String? @db.Text
  
  // UTM Parameters
  utmSource   String? @db.VarChar(255)
  utmMedium   String? @db.VarChar(255)
  utmCampaign String? @db.VarChar(255)
  utmTerm     String? @db.VarChar(255)
  utmContent  String? @db.VarChar(255)
  
  // Fraud Detection
  fraudScore   Float?   @db.DoublePrecision
  riskLevel    String?  @db.VarChar(20) // LOW, MEDIUM, HIGH
  isFraudulent Boolean  @default(false)
  isVerified   Boolean  @default(false)
  verifiedAt   DateTime? @db.Timestamptz(3)
  
  // Invoice
  invoiceNumber  String?   @db.VarChar(100)
  invoiceUrl     String?   @db.Text
  invoiceDate    DateTime? @db.Date
  packingSlipUrl String?   @db.Text
  
  // Packaging
  weight            Float? @db.DoublePrecision
  dimensionalWeight Float? @db.DoublePrecision
  numberOfPackages  Int    @default(1)
  packageDetails    Json?  @db.JsonB
  
  // Commission & Seller
  totalCommission   Float @default(0) @db.DoublePrecision
  sellerPayout      Float @default(0) @db.DoublePrecision
  platformFee       Float @default(0) @db.DoublePrecision
  
  // Additional Features
  isSubscription     Boolean @default(false)
  subscriptionId     String? @db.VarChar(50)
  isPreOrder         Boolean @default(false)
  isBackOrder        Boolean @default(false)
  isDropship         Boolean @default(false)
  requiresSignature  Boolean @default(false)
  
  // Metadata
  customFields Json?    @db.JsonB
  metadata     Json?    @db.JsonB
  createdAt    DateTime @default(now()) @db.Timestamptz(3)
  updatedAt    DateTime @updatedAt @db.Timestamptz(3)
  
  // ============================================================================
  // RELATIONS - Order Related
  // ============================================================================
  
  user  User  @relation(fields: [userId], references: [id])
  admin Admin @relation(fields: [adminId], references: [id])
  
  items           OrderItem[]
  statusHistory   OrderStatusHistory[]
  shipments       Shipment[]
  invoices        Invoice[]
  returnRequests  ReturnRequest[]
  refunds         Refund[]
  transactions    Transaction[]

  @@index([orderNumber])
  @@index([userId, createdAt(sort: Desc)])
  @@index([adminId])
  @@index([sellerId])
  @@index([status])
  @@index([paymentStatus])
  @@index([fulfillmentStatus])
  @@index([status, paymentStatus])
  @@index([createdAt(sort: Desc)])
  @@index([trackingNumber])
  @@index([transactionId])
  @@index([deliveredAt])
  @@index([shippedAt])
  @@index([userEmail])
  @@index([userPhone])
  
  @@map("orders")
}

model OrderItem {
  id      String  @id @default(cuid())
  orderId String
  productId String
  
  // Product Info (denormalized for historical accuracy)
  productName  String  @db.VarChar(500)
  productSlug  String? @db.VarChar(500)
  productImage String? @db.Text
  sku          String? @db.VarChar(100)
  
  // Variant Information
  variantId   String? @db.VarChar(50)
  variantInfo Json?   @db.JsonB
  
  // Customization
  customization Json? @db.JsonB
  
  // Quantity & Pricing
  quantity  Int   @default(1)
  unitPrice Float @db.DoublePrecision
  price     Float @db.DoublePrecision
  
  // Discounts & Tax
  discount     Float @default(0) @db.DoublePrecision
  discountType String? @db.VarChar(20)
  tax          Float @default(0) @db.DoublePrecision
  taxRate      Float @default(0) @db.DoublePrecision
  
  // Calculated Total
  total Float @db.DoublePrecision
  
  // Physical Attributes
  weight     Float? @db.DoublePrecision
  dimensions Json?  @db.JsonB
  
  // Commission & Seller
  commission     Float  @default(0) @db.DoublePrecision
  commissionRate Float  @default(0) @db.DoublePrecision
  sellerId       String? @db.VarChar(50)
  sellerPayout   Float  @default(0) @db.DoublePrecision
  
  // Return & Refund Policies
  isRefundable Boolean @default(true)
  isReturnable Boolean @default(true)
  returnWindow Int?    @default(30) // days
  
  // Warranty
  warrantyPeriod Int?    // days
  warrantyType   String? @db.VarChar(100)
  
  // Fulfillment Status
  isFulfilled   Boolean   @default(false)
  fulfilledAt   DateTime? @db.Timestamptz(3)
  isShipped     Boolean   @default(false)
  shippedAt     DateTime? @db.Timestamptz(3)
  isDelivered   Boolean   @default(false)
  deliveredAt   DateTime? @db.Timestamptz(3)
  
  // Gift
  isGift       Boolean @default(false)
  giftWrap     Boolean @default(false)
  giftWrapCost Float   @default(0) @db.DoublePrecision
  
  // Notes
  notes String? @db.Text
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  order          Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product        Product         @relation(fields: [productId], references: [id])
  returnRequests ReturnRequest[]

  @@index([orderId])
  @@index([productId])
  @@index([variantId])
  @@index([sku])
  @@index([sellerId])
  @@index([isFulfilled])
  @@index([isShipped])
  @@index([isDelivered])
  
  @@map("order_items")
}

model OrderStatusHistory {
  id      String      @id @default(cuid())
  orderId String
  status  OrderStatus
  
  // Details
  comment  String? @db.Text
  location String? @db.VarChar(255)
  
  // Tracking
  trackingEvent String? @db.VarChar(255)
  
  // Who made the change
  createdBy  String? @db.VarChar(50)
  isCustomer Boolean @default(false)
  isSystem   Boolean @default(false)
  
  // Additional Data
  metadata Json? @db.JsonB
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([status])
  @@index([createdAt(sort: Desc)])
  @@index([createdBy])
  
  @@map("order_status_history")
}

// ============================================================================
// SHIPMENT MODELS
// ============================================================================

enum ShipmentStatus {
  PENDING
  LABEL_CREATED
  PICKED_UP
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  FAILED
  RETURNED
  CANCELLED
  EXCEPTION
}

model Shipment {
  id      String @id @default(cuid())
  orderId String
  
  // Tracking
  trackingNumber String  @unique @db.VarChar(255)
  carrier        String  @db.VarChar(100)
  service        String? @db.VarChar(100)
  trackingUrl    String? @db.Text
  
  // Package Details
  weight      Float  @db.DoublePrecision
  length      Float? @db.DoublePrecision
  width       Float? @db.DoublePrecision
  height      Float? @db.DoublePrecision
  packageType String? @db.VarChar(100)
  
  // Shipping Costs
  shippingCost     Float @db.DoublePrecision
  insuranceCost    Float @default(0) @db.DoublePrecision
  declaredValue    Float? @db.DoublePrecision
  
  // Label
  shippingLabel    String? @db.Text
  labelFormat      String? @db.VarChar(20)
  
  // Status
  status ShipmentStatus @default(PENDING)
  
  // Delivery
  estimatedDelivery DateTime? @db.Timestamptz(3)
  actualDelivery    DateTime? @db.Timestamptz(3)
  
  // Proof of Delivery
  signature      String? @db.Text
  deliveryProof  String? @db.Text
  receivedBy     String? @db.VarChar(255)
  
  // Pickup
  pickupScheduled DateTime? @db.Timestamptz(3)
  pickedUpAt      DateTime? @db.Timestamptz(3)
  
  // Notes
  notes          String? @db.Text
  specialHandling String? @db.Text
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  order          Order              @relation(fields: [orderId], references: [id], onDelete: Cascade)
  trackingEvents ShipmentTracking[]

  @@index([orderId])
  @@index([trackingNumber])
  @@index([carrier])
  @@index([status])
  @@index([createdAt(sort: Desc)])
  
  @@map("shipments")
}

model ShipmentTracking {
  id         String @id @default(cuid())
  shipmentId String
  
  // Event Details
  status      String  @db.VarChar(100)
  description String? @db.Text
  location    String? @db.VarChar(255)
  
  // Coordinates
  latitude  Float? @db.DoublePrecision
  longitude Float? @db.DoublePrecision
  
  // Timestamp
  timestamp DateTime @db.Timestamptz(3)
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  shipment Shipment @relation(fields: [shipmentId], references: [id], onDelete: Cascade)

  @@index([shipmentId])
  @@index([timestamp(sort: Desc)])
  @@index([status])
  
  @@map("shipment_tracking")
}

// ============================================================================
// INVOICE MODEL
// ============================================================================

enum InvoiceStatus {
  DRAFT
  PENDING
  SENT
  VIEWED
  PAID
  PARTIALLY_PAID
  OVERDUE
  CANCELLED
  REFUNDED
}

model Invoice {
  id      String @id @default(cuid())
  orderId String
  
  // Invoice Details
  invoiceNumber String        @unique @db.VarChar(100)
  invoiceDate   DateTime      @db.Date
  dueDate       DateTime?     @db.Date
  status        InvoiceStatus @default(PENDING)
  
  // Amounts
  subtotal Float @db.DoublePrecision
  tax      Float @db.DoublePrecision
  discount Float @default(0) @db.DoublePrecision
  total    Float @db.DoublePrecision
  
  // Currency
  currency String @default("INR") @db.VarChar(10)
  
  // Payment
  amountPaid      Float     @default(0) @db.DoublePrecision
  amountDue       Float     @db.DoublePrecision
  paidAt          DateTime? @db.Timestamptz(3)
  paymentMethod   String?   @db.VarChar(100)
  
  // Files
  fileUrl     String? @db.Text
  pdfUrl      String? @db.Text
  
  // Tax Details
  taxBreakdown Json? @db.JsonB
  gstNumber    String? @db.VarChar(50)
  
  // Notes
  notes        String? @db.Text
  termsAndConditions String? @db.Text
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([invoiceNumber])
  @@index([status])
  @@index([invoiceDate(sort: Desc)])
  @@index([dueDate])
  
  @@map("invoices")
}

// ============================================================================
// TRANSACTION MODEL (Payment Transactions)
// ============================================================================

enum TransactionType {
  PAYMENT
  REFUND
  CHARGEBACK
  ADJUSTMENT
  FEE
  COMMISSION
  PAYOUT
}

enum TransactionStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REVERSED
}

model Transaction {
  id      String @id @default(cuid())
  orderId String?
  userId  String?
  
  // Transaction Details
  transactionId   String          @unique @db.VarChar(255)
  type            TransactionType
  status          TransactionStatus @default(PENDING)
  
  // Payment Details
  paymentMethod  PaymentMethod
  paymentGateway String         @db.VarChar(100)
  
  // Amounts
  amount       Float  @db.DoublePrecision
  currency     String @default("INR") @db.VarChar(10)
  exchangeRate Float  @default(1.0) @db.DoublePrecision
  
  // Fee
  gatewayFee   Float @default(0) @db.DoublePrecision
  platformFee  Float @default(0) @db.DoublePrecision
  netAmount    Float @db.DoublePrecision
  
  // Gateway Response
  gatewayResponse Json? @db.JsonB
  
  // Error
  errorCode    String? @db.VarChar(100)
  errorMessage String? @db.Text
  
  // Notes
  description String? @db.Text
  notes       String? @db.Text
  
  // Metadata
  metadata    Json?    @db.JsonB
  processedAt DateTime? @db.Timestamptz(3)
  createdAt   DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  order Order? @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@index([userId])
  @@index([transactionId])
  @@index([type])
  @@index([status])
  @@index([paymentGateway])
  @@index([createdAt(sort: Desc)])
  
  @@map("transactions")
}

// ============================================================================
// REFUND MODEL
// ============================================================================

model Refund {
  id      String @id @default(cuid())
  orderId String
  
  // Refund Details
  refundNumber String @unique @db.VarChar(100)
  reason       String @db.Text
  
  // Amount
  amount       Float @db.DoublePrecision
  currency     String @default("INR") @db.VarChar(10)
  
  // Method
  refundMethod String  @db.VarChar(100)
  refundTo     String? @db.VarChar(255) // Account/Card details
  
  // Status
  status RefundStatus @default(PENDING)
  
  // Processing
  initiatedAt  DateTime? @db.Timestamptz(3)
  processedAt  DateTime? @db.Timestamptz(3)
  completedAt  DateTime? @db.Timestamptz(3)
  
  // Gateway
  transactionId   String? @db.VarChar(255)
  gatewayResponse Json?   @db.JsonB
  
  // Approval
  approvedBy String? @db.VarChar(50)
  approvedAt DateTime? @db.Timestamptz(3)
  rejectedBy String? @db.VarChar(50)
  rejectedAt DateTime? @db.Timestamptz(3)
  rejectionReason String? @db.Text
  
  // Notes
  notes String? @db.Text
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  order Order @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@index([refundNumber])
  @@index([status])
  @@index([createdAt(sort: Desc)])
  
  @@map("refunds")
}// ============================================================================
// REVIEW & RATING MODELS
// ============================================================================

enum ReviewStatus {
  PENDING
  APPROVED
  REJECTED
  SPAM
  FLAGGED
  HIDDEN
}

model Review {
  id     String @id @default(cuid())
  userId String
  productId String
  orderId   String? @db.VarChar(50)
  orderItemId String? @db.VarChar(50)
  
  // Rating & Content
  rating  Int    @db.SmallInt // 1-5
  title   String? @db.VarChar(500)
  comment String? @db.Text
  
  // Media
  images String[] @db.Text
  videos String[] @db.Text
  
  // Verification
  isVerified  Boolean @default(false)
  isPurchased Boolean @default(false)
  verifiedAt  DateTime? @db.Timestamptz(3)
  
  // Status
  status     ReviewStatus @default(PENDING)
  isApproved Boolean      @default(false)
  isFeatured Boolean      @default(false)
  isPublished Boolean     @default(true)
  
  // Engagement
  helpfulCount   Int @default(0)
  unhelpfulCount Int @default(0)
  commentCount   Int @default(0)
  reportCount    Int @default(0)
  
  // Reporting
  reportReasons String[] @db.VarChar(100)
  isFlagged     Boolean  @default(false)
  flaggedAt     DateTime? @db.Timestamptz(3)
  
  // Admin Reply
  adminReply String?   @db.Text
  repliedAt  DateTime? @db.Timestamptz(3)
  repliedBy  String?   @db.VarChar(50)
  
  // AI Analysis
  sentiment      String? @db.VarChar(20) // POSITIVE, NEGATIVE, NEUTRAL
  sentimentScore Float?  @db.DoublePrecision
  keywords       String[] @db.VarChar(100)
  
  // Attributes Rating (Optional detailed ratings)
  qualityRating  Int? @db.SmallInt
  valueRating    Int? @db.SmallInt
  designRating   Int? @db.SmallInt
  serviceRating  Int? @db.SmallInt
  
  // Language & Location
  language String  @default("en") @db.VarChar(10)
  country  String? @db.VarChar(100)
  
  // Device Info
  ipAddress String? @db.VarChar(45)
  userAgent String? @db.Text
  
  // Incentivized
  isIncentivized Boolean @default(false)
  incentiveType  String? @db.VarChar(100)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user     User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  product  Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  helpful  ReviewHelpful[]
  comments ReviewComment[]
  reports  ReviewReport[]

  @@index([userId])
  @@index([productId])
  @@index([rating])
  @@index([status])
  @@index([isApproved])
  @@index([isPurchased])
  @@index([isFeatured])
  @@index([createdAt(sort: Desc)])
  @@index([helpfulCount(sort: Desc)])
  @@index([sentiment])
  @@fulltext([title, comment])
  
  @@map("reviews")
}

model ReviewHelpful {
  id       String  @id @default(cuid())
  reviewId String
  userId   String?
  sessionId String? @db.VarChar(255)
  
  // Vote
  isHelpful Boolean
  
  // Device
  ipAddress String? @db.VarChar(45)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  review Review @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@unique([reviewId, userId])
  @@unique([reviewId, sessionId])
  @@index([reviewId])
  @@index([userId])
  
  @@map("review_helpful")
}

model ReviewComment {
  id       String @id @default(cuid())
  reviewId String
  userId   String?
  
  // Content
  comment String @db.Text
  
  // Author Info (for guests)
  authorName  String? @db.VarChar(255)
  authorEmail String? @db.VarChar(255)
  
  // Status
  isApproved Boolean @default(false)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  review Review @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@index([reviewId])
  @@index([userId])
  @@index([createdAt(sort: Desc)])
  
  @@map("review_comments")
}

model ReviewReport {
  id       String @id @default(cuid())
  reviewId String
  userId   String?
  
  // Report Details
  reason      String  @db.VarChar(100)
  description String? @db.Text
  
  // Status
  status     String  @default("PENDING") @db.VarChar(50)
  reviewedBy String? @db.VarChar(50)
  reviewedAt DateTime? @db.Timestamptz(3)
  
  // Device
  ipAddress String? @db.VarChar(45)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  review Review @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@index([reviewId])
  @@index([userId])
  @@index([status])
  @@index([reason])
  
  @@map("review_reports")
}

// ============================================================================
// PRODUCT Q&A MODEL
// ============================================================================

model ProductQA {
  id        String @id @default(cuid())
  productId String
  userId    String
  
  // Question
  question String @db.Text
  
  // Answer
  answer     String?   @db.Text
  answeredBy String?   @db.VarChar(50) // USER_ID, ADMIN, SELLER
  answeredAt DateTime? @db.Timestamptz(3)
  
  // Status
  isPublic   Boolean @default(true)
  isApproved Boolean @default(true)
  isFeatured Boolean @default(false)
  
  // Engagement
  helpfulCount Int @default(0)
  reportCount  Int @default(0)
  upvotes      Int @default(0)
  downvotes    Int @default(0)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([userId])
  @@index([isPublic])
  @@index([isApproved])
  @@index([isFeatured])
  @@index([createdAt(sort: Desc)])
  @@fulltext([question, answer])
  
  @@map("product_qas")
}

model ProductQuestion {
  id        String @id @default(cuid())
  productId String
  userId    String?
  
  // Question
  question String @db.Text
  
  // Author (for guests)
  authorName  String? @db.VarChar(255)
  authorEmail String? @db.VarChar(255)
  
  // Answer
  answer     String?   @db.Text
  answeredBy String?   @db.VarChar(50)
  answeredAt DateTime? @db.Timestamptz(3)
  
  // Status
  isPublic   Boolean @default(true)
  isApproved Boolean @default(true)
  
  // Engagement
  upvotes   Int @default(0)
  downvotes Int @default(0)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([userId])
  @@index([isPublic])
  @@index([isApproved])
  
  @@map("product_questions")
}

// ============================================================================
// COUPON & DISCOUNT MODELS
// ============================================================================

enum DiscountType {
  PERCENTAGE
  FIXED
  FREE_SHIPPING
  BUY_X_GET_Y
  FLAT_RATE
}

model Coupon {
  id     String       @id @default(cuid())
  code   String       @unique @db.VarChar(100)
  name   String?      @db.VarChar(255)
  description String? @db.Text
  
  // Discount Configuration
  discountType  DiscountType
  discountValue Float        @db.DoublePrecision
  maxDiscount   Float?       @db.DoublePrecision
  
  // Conditions
  minPurchase       Float? @db.DoublePrecision
  maxPurchase       Float? @db.DoublePrecision
  minItems          Int?   @default(1)
  
  // Usage Limits
  usageLimit       Int? // Total uses
  usagePerUser     Int? @default(1)
  usedCount        Int  @default(0)
  
  // Validity
  validFrom  DateTime @db.Timestamptz(3)
  validUntil DateTime @db.Timestamptz(3)
  
  // Status
  isActive   Boolean @default(true)
  isPublic   Boolean @default(true)
  stackable  Boolean @default(false)
  autoApply  Boolean @default(false)
  
  // Product/Category Restrictions
  applicableCategories String[] @db.VarChar(50)
  applicableProducts   String[] @db.VarChar(50)
  excludedCategories   String[] @db.VarChar(50)
  excludedProducts     String[] @db.VarChar(50)
  applicableBrands     String[] @db.VarChar(50)
  
  // User Restrictions
  userRestrictions String[] @db.VarChar(50) // Specific user IDs
  userSegments     String[] @db.VarChar(100) // NEW_USER, VIP, etc.
  firstOrderOnly   Boolean  @default(false)
  newUsersOnly     Boolean  @default(false)
  
  // Device & Location Restrictions
  deviceRestrictions   String[] @db.VarChar(50) // WEB, MOBILE, APP
  locationRestrictions Json?    @db.JsonB // Countries, states, cities
  
  // Time Restrictions
  timeLimitMinutes Int? // Time limit after activation
  daysOfWeek       String[] @db.VarChar(10) // MON, TUE, etc.
  timeOfDay        Json?    @db.JsonB // Start/end hours
  
  // BuyXGetY Configuration (if applicable)
  buyXGetYConfig Json? @db.JsonB
  
  // Advanced Conditions
  conditions Json? @db.JsonB
  
  // Ownership
  adminId String?
  
  // Analytics
  viewCount       Int   @default(0)
  clickCount      Int   @default(0)
  conversionCount Int   @default(0)
  totalRevenue    Float @default(0) @db.DoublePrecision
  totalDiscount   Float @default(0) @db.DoublePrecision
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  admin Admin?        @relation(fields: [adminId], references: [id], onDelete: SetNull)
  usage CouponUsage[]

  @@index([code])
  @@index([isActive])
  @@index([isPublic])
  @@index([validFrom, validUntil])
  @@index([adminId])
  @@index([usedCount])
  
  @@map("coupons")
}

model CouponUsage {
  id       String  @id @default(cuid())
  couponId String
  userId   String?
  orderId  String? @db.VarChar(50)
  
  // Usage Details
  discount     Float  @db.DoublePrecision
  orderTotal   Float  @db.DoublePrecision
  discountType String @db.VarChar(20)
  
  // Device & Location
  ipAddress String? @db.VarChar(45)
  userAgent String? @db.Text
  country   String? @db.VarChar(100)
  city      String? @db.VarChar(100)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  coupon Coupon @relation(fields: [couponId], references: [id], onDelete: Cascade)

  @@index([couponId])
  @@index([userId])
  @@index([orderId])
  @@index([createdAt(sort: Desc)])
  
  @@map("coupon_usage")
}

// ============================================================================
// RETURN & REFUND REQUEST MODELS
// ============================================================================

enum ReturnStatus {
  REQUESTED
  PENDING
  APPROVED
  REJECTED
  PICKUP_SCHEDULED
  PICKED_UP
  IN_TRANSIT
  RECEIVED
  INSPECTING
  INSPECTED
  APPROVED_FOR_REFUND
  REFUNDED
  REPLACED
  CANCELLED
  COMPLETED
}

enum ReturnReason {
  DEFECTIVE
  WRONG_ITEM
  SIZE_ISSUE
  COLOR_ISSUE
  NOT_AS_DESCRIBED
  DAMAGED
  QUALITY_ISSUE
  CHANGED_MIND
  BETTER_PRICE
  DUPLICATE_ORDER
  OTHER
}

model ReturnRequest {
  id          String @id @default(cuid())
  orderId     String
  orderItemId String
  userId      String
  
  // Return Details
  returnNumber String       @unique @db.VarChar(100)
  requestType  String       @default("RETURN") @db.VarChar(20) // RETURN, REPLACE, REFUND
  reason       ReturnReason
  reasonDetails String?     @db.Text
  
  // Media
  images String[] @db.Text
  videos String[] @db.Text
  
  // Status
  status ReturnStatus @default(REQUESTED)
  
  // Product Condition
  productCondition String? @db.VarChar(100)
  
  // Admin Review
  adminComment    String? @db.Text
  
  // Refund Information
  refundAmount Float? @db.DoublePrecision
  refundMethod String? @db.VarChar(100)
  restockFee   Float  @default(0) @db.DoublePrecision
  shippingCost Float  @default(0) @db.DoublePrecision
  
  // Pickup Details
  pickupAddress   Json?     @db.JsonB
  pickupScheduled DateTime? @db.Timestamptz(3)
  pickedUpAt      DateTime? @db.Timestamptz(3)
  
  // Receiving Details
  receivedAt      DateTime? @db.Timestamptz(3)
  inspectedAt     DateTime? @db.Timestamptz(3)
  inspectionNotes String?   @db.Text
  
  // Approval/Rejection
  approvedAt      DateTime? @db.Timestamptz(3)
  approvedBy      String?   @db.VarChar(50)
  rejectedAt      DateTime? @db.Timestamptz(3)
  rejectedBy      String?   @db.VarChar(50)
  rejectionReason String?   @db.Text
  
  // Completion
  completedAt DateTime? @db.Timestamptz(3)
  
  // Shipping (Return shipment)
  trackingNumber String? @db.VarChar(255)
  carrier        String? @db.VarChar(100)
  shippingLabel  String? @db.Text
  
  // Replacement (if applicable)
  replacementOrderId String? @db.VarChar(50)
  
  // Quality Control
  qcPassed  Boolean? 
  qcNotes   String? @db.Text
  qcCheckedBy String? @db.VarChar(50)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user      User      @relation(fields: [userId], references: [id])
  order     Order     @relation(fields: [orderId], references: [id])
  orderItem OrderItem @relation(fields: [orderItemId], references: [id])

  @@index([userId])
  @@index([orderId])
  @@index([orderItemId])
  @@index([returnNumber])
  @@index([status])
  @@index([reason])
  @@index([createdAt(sort: Desc)])
  
  @@map("return_requests")
}

// ============================================================================
// NOTIFICATION MODELS
// ============================================================================

enum NotificationChannel {
  IN_APP
  EMAIL
  SMS
  PUSH
  WHATSAPP
  TELEGRAM
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

model Notification {
  id     String           @id @default(cuid())
  userId String
  type   NotificationType
  
  // Content
  title   String @db.VarChar(500)
  message String @db.Text
  
  // Additional Data
  data  Json?   @db.JsonB
  link  String? @db.Text
  image String? @db.Text
  icon  String? @db.Text
  
  // Action
  action    String? @db.VarChar(100)
  actionUrl String? @db.Text
  
  // Priority & Channel
  priority NotificationPriority @default(NORMAL)
  channel  NotificationChannel[] @default([IN_APP])
  
  // Read Status
  isRead Boolean   @default(false)
  readAt DateTime? @db.Timestamptz(3)
  
  // Delivery Status
  isSent Boolean   @default(false)
  sentAt DateTime? @db.Timestamptz(3)
  
  // Delivery Tracking
  emailSent    Boolean   @default(false)
  emailSentAt  DateTime? @db.Timestamptz(3)
  smsSent      Boolean   @default(false)
  smsSentAt    DateTime? @db.Timestamptz(3)
  pushSent     Boolean   @default(false)
  pushSentAt   DateTime? @db.Timestamptz(3)
  
  // Scheduling
  scheduledFor DateTime? @db.Timestamptz(3)
  
  // Expiry
  expiresAt DateTime? @db.Timestamptz(3)
  
  // Grouping
  groupKey String? @db.VarChar(255)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([isRead])
  @@index([priority])
  @@index([scheduledFor])
  @@index([createdAt(sort: Desc)])
  @@index([groupKey])
  @@index([expiresAt])
  
  @@map("notifications")
}

// ============================================================================
// STOCK & PRICE ALERT MODELS
// ============================================================================

model StockAlert {
  id        String  @id @default(cuid())
  userId    String
  productId String
  variantId String? @db.VarChar(50)
  
  // Alert Configuration
  threshold Int @default(1)
  
  // Status
  isActive Boolean @default(true)
  
  // Notification
  notified   Boolean   @default(false)
  notifiedAt DateTime? @db.Timestamptz(3)
  notifyEmail Boolean  @default(true)
  notifySms   Boolean  @default(false)
  notifyPush  Boolean  @default(true)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId, variantId])
  @@index([userId])
  @@index([productId])
  @@index([isActive])
  @@index([notified])
  
  @@map("stock_alerts")
}

model StockNotification {
  id        String @id @default(cuid())
  productId String
  variantId String? @db.VarChar(50)
  email     String  @db.VarChar(255)
  phone     String? @db.VarChar(20)
  
  // Status
  notified   Boolean   @default(false)
  notifiedAt DateTime? @db.Timestamptz(3)
  
  // Source
  source String? @db.VarChar(100) // PRODUCT_PAGE, CART, WISHLIST
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([variantId])
  @@index([email])
  @@index([notified])
  
  @@map("stock_notifications")
}

model PriceAlert {
  id        String  @id @default(cuid())
  userId    String
  productId String
  variantId String? @db.VarChar(50)
  
  // Price Configuration
  targetPrice  Float  @db.DoublePrecision
  currentPrice Float  @db.DoublePrecision
  condition    String @default("LESS_THAN") @db.VarChar(20) // LESS_THAN, LESS_THAN_EQUAL
  
  // Status
  isActive Boolean @default(true)
  
  // Notification
  notified   Boolean   @default(false)
  notifiedAt DateTime? @db.Timestamptz(3)
  
  // Expiry
  expiresAt DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId, variantId])
  @@index([userId])
  @@index([productId])
  @@index([isActive])
  @@index([notified])
  @@index([expiresAt])
  
  @@map("price_alerts")
}

// ============================================================================
// ACTIVITY & TRACKING MODELS
// ============================================================================

model ViewHistory {
  id        String  @id @default(cuid())
  userId    String?
  productId String
  variantId String? @db.VarChar(50)
  sessionId String? @db.VarChar(255)
  
  // View Details
  duration Int? // in seconds
  
  // Source
  source   String? @db.VarChar(100)
  referrer String? @db.Text
  
  // Device
  deviceType String? @db.VarChar(50)
  ipAddress  String? @db.VarChar(45)
  userAgent  String? @db.Text
  
  // Location
  country String? @db.VarChar(100)
  city    String? @db.VarChar(100)
  
  // Timestamp
  viewedAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user    User?   @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([productId])
  @@index([sessionId])
  @@index([viewedAt(sort: Desc)])
  
  @@map("view_history")
}

model RecentlyViewed {
  id        String @id @default(cuid())
  userId    String
  productId String
  variantId String? @db.VarChar(50)
  
  // Counter
  viewCount Int @default(1)
  
  // Last View
  lastViewed DateTime @default(now()) @db.Timestamptz(3)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
  @@index([productId])
  @@index([lastViewed(sort: Desc)])
  
  @@map("recently_viewed")
}

model SearchHistory {
  id       String @id @default(cuid())
  userId   String?
  sessionId String? @db.VarChar(255)
  query    String  @db.VarChar(500)
  
  // Filters Applied
  filters Json? @db.JsonB
  
  // Results
  resultCount Int @default(0)
  
  // User Interaction
  clicked   Boolean @default(false)
  clickedId String? @db.VarChar(50)
  position  Int?    // Position in search results
  
  // Source
  source String? @db.VarChar(100)
  
  // Timestamp
  searchedAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([sessionId])
  @@index([query])
  @@index([clicked])
  @@index([searchedAt(sort: Desc)])
  @@fulltext([query])
  
  @@map("search_history")
}

model ClickTracking {
  id          String  @id @default(cuid())
  userId      String? @db.VarChar(50)
  sessionId   String? @db.VarChar(255)
  
  // Element Details
  elementId   String  @db.VarChar(255)
  elementType String  @db.VarChar(100)
  elementText String? @db.VarChar(500)
  
  // Page
  page String @db.VarChar(255)
  url  String @db.Text
  
  // Position
  position Json? @db.JsonB
  
  // Device
  ipAddress String? @db.VarChar(45)
  userAgent String? @db.Text
  
  // Additional Data
  metadata Json? @db.JsonB
  
  // Timestamp
  clickedAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([elementId])
  @@index([elementType])
  @@index([page])
  @@index([userId])
  @@index([sessionId])
  @@index([clickedAt(sort: Desc)])
  
  @@map("click_tracking")
}// ============================================================================
// LOYALTY & REWARDS MODELS
// ============================================================================

enum LoyaltyTier {
  BRONZE
  SILVER
  GOLD
  PLATINUM
  DIAMOND
  VIP
}

enum LoyaltyType {
  EARNED
  REDEEMED
  EXPIRED
  BONUS
  REFUND
  GIFT
  REFERRAL
  BIRTHDAY
  ANNIVERSARY
  PURCHASE
  REVIEW
  SOCIAL_SHARE
  SIGN_UP
  ADJUSTMENT
}

model LoyaltyPoints {
  id     String      @id @default(cuid())
  userId String      @unique
  
  // Points Balance
  totalEarned    Int @default(0)
  totalSpent     Int @default(0)
  currentBalance Int @default(0)
  lifetimePoints Int @default(0)
  
  // Tier Information
  tier             LoyaltyTier  @default(BRONZE)
  tierProgress     Float        @default(0) @db.DoublePrecision
  nextTier         LoyaltyTier?
  pointsToNextTier Int          @default(0)
  tierStartDate    DateTime?    @db.Timestamptz(3)
  
  // Expiring Points
  expiringPoints Int       @default(0)
  nextExpiryDate DateTime? @db.Timestamptz(3)
  
  // Multiplier
  multiplier Float @default(1.0) @db.DoublePrecision
  
  // Tier Benefits
  tierBenefits Json? @db.JsonB
  
  // Statistics
  totalTransactions Int   @default(0)
  totalRedemptions  Int   @default(0)
  averageEarnRate   Float @default(0) @db.DoublePrecision
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user         User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions LoyaltyTransaction[]

  @@index([userId])
  @@index([tier])
  @@index([currentBalance(sort: Desc)])
  @@index([nextExpiryDate])
  
  @@map("loyalty_points")
}

model LoyaltyTransaction {
  id        String      @id @default(cuid())
  loyaltyId String
  userId    String      @db.VarChar(50)
  type      LoyaltyType
  
  // Points
  points      Int   @db.Integer
  balance     Int   @db.Integer // Balance after transaction
  
  // Description
  description String? @db.Text
  
  // Reference
  reference   String? @db.VarChar(255)
  orderId     String? @db.VarChar(50)
  productId   String? @db.VarChar(50)
  campaignId  String? @db.VarChar(50)
  
  // Multiplier Applied
  multiplier Float @default(1.0) @db.DoublePrecision
  
  // Expiry
  expiresAt DateTime? @db.Timestamptz(3)
  isExpired Boolean   @default(false)
  expiredAt DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  loyalty LoyaltyPoints @relation(fields: [loyaltyId], references: [id], onDelete: Cascade)

  @@index([loyaltyId])
  @@index([userId])
  @@index([type])
  @@index([orderId])
  @@index([expiresAt])
  @@index([createdAt(sort: Desc)])
  
  @@map("loyalty_transactions")
}

model RewardPoint {
  id     String @id @default(cuid())
  userId String
  
  // Points
  points Int @db.Integer
  
  // Source
  source      String  @db.VarChar(100)
  sourceId    String? @db.VarChar(50)
  description String? @db.Text
  
  // Expiry
  expiresAt DateTime? @db.Timestamptz(3)
  
  // Usage
  usedAt DateTime? @db.Timestamptz(3)
  usedIn String?   @db.VarChar(50) // Order ID or reference
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([source])
  @@index([expiresAt])
  @@index([usedAt])
  
  @@map("reward_points")
}

model VIPMembership {
  id     String @id @default(cuid())
  userId String @unique
  
  // Tier
  tier   String @db.VarChar(50)
  status String @default("ACTIVE") @db.VarChar(50)
  
  // Dates
  startDate   DateTime @default(now()) @db.Timestamptz(3)
  renewalDate DateTime @db.Timestamptz(3)
  expiresAt   DateTime? @db.Timestamptz(3)
  
  // Benefits
  benefits        Json    @db.JsonB
  discountRate    Float   @default(0) @db.DoublePrecision
  freeShipping    Boolean @default(false)
  prioritySupport Boolean @default(false)
  earlyAccess     Boolean @default(false)
  
  // Additional Perks
  monthlyCredits    Float @default(0) @db.DoublePrecision
  bonusPoints       Int   @default(0)
  exclusiveDeals    Boolean @default(false)
  personalStylist   Boolean @default(false)
  
  // Spending Tracking
  totalSpent         Float @default(0) @db.DoublePrecision
  currentYearSpend   Float @default(0) @db.DoublePrecision
  spendToMaintain    Float @default(0) @db.DoublePrecision
  
  // Auto-renewal
  autoRenew Boolean @default(true)
  
  // Payment
  subscriptionId String? @db.VarChar(100)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([tier])
  @@index([status])
  @@index([renewalDate])
  @@index([expiresAt])
  
  @@map("vip_memberships")
}

// ============================================================================
// GAMIFICATION MODELS
// ============================================================================

model GamificationProgress {
  id     String @id @default(cuid())
  userId String @unique
  
  // Level & Experience
  level       Int   @default(1)
  experience  Int   @default(0)
  nextLevelXp Int   @default(100)
  totalXp     Int   @default(0)
  
  // Streak
  streak        Int @default(0)
  longestStreak Int @default(0)
  lastActiveDate DateTime @default(now()) @db.Date
  
  // Achievements
  totalBadges       Int @default(0)
  totalAchievements Int @default(0)
  
  // Ranking
  rank                String? @db.VarChar(100)
  leaderboardPosition Int?
  
  // Statistics
  totalPurchases    Int   @default(0)
  totalReviews      Int   @default(0)
  totalReferrals    Int   @default(0)
  totalShares       Int   @default(0)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([level(sort: Desc)])
  @@index([experience(sort: Desc)])
  @@index([streak(sort: Desc)])
  @@index([leaderboardPosition])
  
  @@map("gamification_progress")
}

model Badge {
  id          String @id @default(cuid())
  name        String @unique @db.VarChar(255)
  slug        String @unique @db.VarChar(255)
  description String? @db.Text
  
  // Visual
  image     String  @db.Text
  icon      String? @db.Text
  color     String? @db.VarChar(50)
  
  // Classification
  category String? @db.VarChar(100)
  rarity   String  @default("COMMON") @db.VarChar(50) // COMMON, UNCOMMON, RARE, EPIC, LEGENDARY
  
  // Rewards
  points Int @default(10)
  xp     Int @default(0)
  
  // Requirements
  requirement Json @db.JsonB
  
  // Status
  isActive Boolean @default(true)
  isSecret Boolean @default(false)
  
  // Display Order
  order Int @default(0)
  
  // Statistics
  earnedCount Int @default(0)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  userBadges UserBadge[]

  @@index([slug])
  @@index([category])
  @@index([rarity])
  @@index([isActive])
  @@index([order])
  
  @@map("badges")
}

model UserBadge {
  id      String @id @default(cuid())
  userId  String
  badgeId String
  
  // Progress
  progress Int     @default(0)
  isEarned Boolean @default(false)
  earnedAt DateTime? @db.Timestamptz(3)
  
  // Display
  isDisplayed Boolean @default(false)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  badge Badge @relation(fields: [badgeId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
  @@index([userId])
  @@index([badgeId])
  @@index([isEarned])
  @@index([earnedAt(sort: Desc)])
  
  @@map("user_badges")
}

model Achievement {
  id          String @id @default(cuid())
  name        String @unique @db.VarChar(255)
  slug        String @unique @db.VarChar(255)
  description String? @db.Text
  
  // Visual
  icon  String? @db.Text
  image String? @db.Text
  
  // Classification
  category String? @db.VarChar(100)
  tier     String  @default("BRONZE") @db.VarChar(50) // BRONZE, SILVER, GOLD, PLATINUM
  
  // Rewards
  points   Int @default(50)
  xpReward Int @default(100)
  
  // Requirements
  requirement Json @db.JsonB
  
  // Repeatability
  isRepeatable Boolean @default(false)
  cooldownDays Int?    // Days before can be earned again
  
  // Status
  isActive Boolean @default(true)
  isSecret Boolean @default(false)
  
  // Display Order
  order Int @default(0)
  
  // Statistics
  completedCount Int @default(0)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  userAchievements UserAchievement[]

  @@index([slug])
  @@index([category])
  @@index([tier])
  @@index([isActive])
  @@index([order])
  
  @@map("achievements")
}

model UserAchievement {
  id            String @id @default(cuid())
  userId        String
  achievementId String
  
  // Progress
  progress    Int @default(0)
  target      Int
  isCompleted Boolean @default(false)
  
  // Completion
  completedAt     DateTime? @db.Timestamptz(3)
  timesCompleted  Int       @default(0)
  lastCompletedAt DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  achievement Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade)

  @@unique([userId, achievementId])
  @@index([userId])
  @@index([achievementId])
  @@index([isCompleted])
  @@index([completedAt(sort: Desc)])
  
  @@map("user_achievements")
}

model Challenge {
  id          String @id @default(cuid())
  name        String @db.VarChar(255)
  slug        String @unique @db.VarChar(255)
  description String? @db.Text
  
  // Visual
  image  String? @db.Text
  banner String? @db.Text
  
  // Type & Difficulty
  type       String @default("DAILY") @db.VarChar(50) // DAILY, WEEKLY, MONTHLY, LIMITED_TIME
  difficulty String @default("EASY") @db.VarChar(50) // EASY, MEDIUM, HARD, EXPERT
  
  // Requirements & Rewards
  requirement Json @db.JsonB
  reward      Json @db.JsonB
  
  // Duration
  startDate DateTime @db.Timestamptz(3)
  endDate   DateTime @db.Timestamptz(3)
  
  // Participation
  maxParticipants     Int? // Limit participants
  currentParticipants Int  @default(0)
  
  // Status
  isActive Boolean @default(true)
  
  // Statistics
  completionRate Float @default(0) @db.DoublePrecision
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  userChallenges UserChallenge[]

  @@index([slug])
  @@index([type])
  @@index([difficulty])
  @@index([isActive])
  @@index([startDate, endDate])
  
  @@map("challenges")
}

model UserChallenge {
  id          String @id @default(cuid())
  userId      String
  challengeId String
  
  // Progress
  progress    Int @default(0)
  target      Int
  isCompleted Boolean @default(false)
  completedAt DateTime? @db.Timestamptz(3)
  
  // Reward
  reward        Json?     @db.JsonB
  rewardClaimed Boolean   @default(false)
  claimedAt     DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  challenge Challenge @relation(fields: [challengeId], references: [id], onDelete: Cascade)

  @@unique([userId, challengeId])
  @@index([userId])
  @@index([challengeId])
  @@index([isCompleted])
  @@index([rewardClaimed])
  
  @@map("user_challenges")
}

model Quest {
  id          String @id @default(cuid())
  name        String @db.VarChar(255)
  slug        String @unique @db.VarChar(255)
  description String? @db.Text
  story       String? @db.Text
  
  // Visual
  image  String? @db.Text
  icon   String? @db.Text
  
  // Classification
  category   String? @db.VarChar(100)
  difficulty String  @default("NORMAL") @db.VarChar(50)
  
  // Steps & Rewards
  steps   Json[] @db.JsonB
  rewards Json   @db.JsonB
  
  // Duration
  duration Int? // in days
  
  // Status
  isActive Boolean @default(true)
  
  // Sequential
  isSequential Boolean @default(true)
  
  // Prerequisites
  prerequisites String[] @db.VarChar(50)
  
  // Statistics
  completionCount Int @default(0)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  userQuests UserQuest[]

  @@index([slug])
  @@index([category])
  @@index([difficulty])
  @@index([isActive])
  
  @@map("quests")
}

model UserQuest {
  id      String @id @default(cuid())
  userId  String
  questId String
  
  // Progress
  currentStep    Int    @default(0)
  stepsCompleted Json[] @db.JsonB
  progress       Int    @default(0)
  
  // Completion
  isCompleted Boolean   @default(false)
  startedAt   DateTime  @default(now()) @db.Timestamptz(3)
  completedAt DateTime? @db.Timestamptz(3)
  
  // Rewards
  rewardsClaimed Boolean @default(false)
  
  // Metadata
  metadata  Json?    @db.JsonB
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  quest Quest @relation(fields: [questId], references: [id], onDelete: Cascade)

  @@unique([userId, questId])
  @@index([userId])
  @@index([questId])
  @@index([isCompleted])
  @@index([currentStep])
  
  @@map("user_quests")
}

model Leaderboard {
  id   String @id @default(cuid())
  name String @db.VarChar(255)
  slug String @unique @db.VarChar(255)
  
  // Type
  type   String @default("POINTS") @db.VarChar(50) // POINTS, PURCHASES, REVIEWS, REFERRALS
  period String @default("ALL_TIME") @db.VarChar(50) // ALL_TIME, YEARLY, MONTHLY, WEEKLY, DAILY
  
  // Duration
  startDate DateTime? @db.Timestamptz(3)
  endDate   DateTime? @db.Timestamptz(3)
  
  // Status
  isActive Boolean @default(true)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  entries LeaderboardEntry[]

  @@index([slug])
  @@index([type])
  @@index([period])
  @@index([isActive])
  
  @@map("leaderboards")
}

model LeaderboardEntry {
  id            String @id @default(cuid())
  leaderboardId String
  userId        String @db.VarChar(50)
  
  // User Info (denormalized)
  userName   String  @db.VarChar(255)
  userAvatar String? @db.Text
  
  // Score
  score        Float @db.DoublePrecision
  rank         Int
  previousRank Int?
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  leaderboard Leaderboard @relation(fields: [leaderboardId], references: [id], onDelete: Cascade)

  @@unique([leaderboardId, userId])
  @@index([leaderboardId])
  @@index([userId])
  @@index([rank])
  @@index([score(sort: Desc)])
  
  @@map("leaderboard_entries")
}

model SpinWheel {
  id          String @id @default(cuid())
  name        String @db.VarChar(255)
  description String? @db.Text
  
  // Prizes Configuration
  prizes Json[] @db.JsonB
  
  // Cost
  spinCost       Int @default(0) // in points or currency
  costType       String @default("POINTS") @db.VarChar(20) // POINTS, CURRENCY, FREE
  
  // Limits
  maxSpinsPerDay  Int? 
  maxSpinsPerUser Int?
  
  // Status
  isActive Boolean @default(true)
  
  // Duration
  startDate DateTime? @db.Timestamptz(3)
  endDate   DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  spins SpinWheelSpin[]

  @@index([isActive])
  @@index([startDate, endDate])
  
  @@map("spin_wheels")
}

model SpinWheelSpin {
  id      String @id @default(cuid())
  userId  String @db.VarChar(50)
  wheelId String
  
  // Prize Won
  prizeWon     Json    @db.JsonB
  prizeValue   Float?  @db.DoublePrecision
  prizeClaimed Boolean @default(false)
  claimedAt    DateTime? @db.Timestamptz(3)
  
  // Cost Paid
  costPaid Float @default(0) @db.DoublePrecision
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  wheel SpinWheel @relation(fields: [wheelId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([wheelId])
  @@index([prizeClaimed])
  @@index([createdAt(sort: Desc)])
  
  @@map("spin_wheel_spins")
}

// ============================================================================
// REFERRAL MODELS
// ============================================================================

enum ReferralStatus {
  PENDING
  SIGNED_UP
  FIRST_PURCHASE
  COMPLETED
  EXPIRED
  CANCELLED
}

model Referral {
  id         String @id @default(cuid())
  referrerId String
  referredId String @unique
  
  // Referral Code
  referralCode String @unique @db.VarChar(100)
  
  // Status
  status ReferralStatus @default(PENDING)
  
  // Rewards
  referrerReward Json? @db.JsonB
  referredReward Json? @db.JsonB
  
  // Rewards Claimed
  rewardsClaimed Boolean   @default(false)
  claimedAt      DateTime? @db.Timestamptz(3)
  
  // First Purchase
  firstPurchaseAt DateTime? @db.Timestamptz(3)
  firstOrderId    String?   @db.VarChar(50)
  
  // Performance
  totalValue Float @default(0) @db.DoublePrecision
  commission Float @default(0) @db.DoublePrecision
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  referrer User @relation("Referrer", fields: [referrerId], references: [id])
  referred User @relation("Referred", fields: [referredId], references: [id])

  @@index([referrerId])
  @@index([referredId])
  @@index([referralCode])
  @@index([status])
  @@index([rewardsClaimed])
  
  @@map("referrals")
}

// ============================================================================
// FLASH SALE & DEAL MODELS
// ============================================================================

enum FlashSaleStatus {
  SCHEDULED
  ACTIVE
  PAUSED
  ENDED
  CANCELLED
}

model FlashSale {
  id          String @id @default(cuid())
  name        String @db.VarChar(255)
  slug        String @unique @db.VarChar(255)
  description String? @db.Text
  
  // Visual
  banner String? @db.Text
  image  String? @db.Text
  
  // Timing
  startTime DateTime @db.Timestamptz(3)
  endTime   DateTime @db.Timestamptz(3)
  timezone  String   @default("Asia/Kolkata") @db.VarChar(50)
  
  // Discount
  discount Float? @db.DoublePrecision
  
  // Limits
  maxQuantity Int? // Total items available
  maxPerUser  Int? // Max per customer
  
  // Status
  status   FlashSaleStatus @default(SCHEDULED)
  isActive Boolean         @default(false)
  
  // Priority
  priority Int @default(0)
  
  // Countdown
  showCountdown Boolean @default(true)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  products FlashSaleProduct[]

  @@index([slug])
  @@index([status])
  @@index([isActive])
  @@index([startTime, endTime])
  @@index([priority(sort: Desc)])
  
  @@map("flash_sales")
}

model FlashSaleProduct {
  id          String @id @default(cuid())
  flashSaleId String
  productId   String
  
  // Discount
  discountType  String @default("PERCENTAGE") @db.VarChar(20)
  discount      Float  @db.DoublePrecision
  salePrice     Float  @db.DoublePrecision
  originalPrice Float  @db.DoublePrecision
  
  // Inventory
  stock      Int? 
  soldCount  Int @default(0)
  maxPerUser Int?
  
  // Status
  isActive Boolean @default(true)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  flashSale FlashSale @relation(fields: [flashSaleId], references: [id], onDelete: Cascade)
  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([flashSaleId, productId])
  @@index([flashSaleId])
  @@index([productId])
  @@index([isActive])
  @@index([soldCount(sort: Desc)])
  
  @@map("flash_sale_products")
}

model DealOfTheDay {
  id        String @id @default(cuid())
  productId String
  
  // Pricing
  originalPrice Float @db.DoublePrecision
  dealPrice     Float @db.DoublePrecision
  discount      Float @db.DoublePrecision
  
  // Inventory
  stock     Int @default(0)
  soldCount Int @default(0)
  
  // Limits
  maxPerUser Int @default(1)
  
  // Timing
  startTime DateTime @db.Timestamptz(3)
  endTime   DateTime @db.Timestamptz(3)
  
  // Status
  isActive Boolean @default(true)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([isActive])
  @@index([startTime, endTime])
  
  @@map("deal_of_the_day")
}

model ComboOffer {
  id          String @id @default(cuid())
  name        String @db.VarChar(255)
  description String? @db.Text
  
  // Products in combo
  productIds String[] @db.VarChar(50)
  
  // Pricing
  totalPrice      Float @db.DoublePrecision
  discountedPrice Float @db.DoublePrecision
  savings         Float @db.DoublePrecision
  
  // Quantity Limits
  minQuantity Int  @default(1)
  maxQuantity Int?
  
  // Status
  isActive Boolean @default(true)
  
  // Validity
  validFrom  DateTime @db.Timestamptz(3)
  validUntil DateTime @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([isActive])
  @@index([validFrom, validUntil])
  
  @@map("combo_offers")
}

model BulkPricing {
  id        String @id @default(cuid())
  productId String
  
  // Quantity Range
  minQuantity Int
  maxQuantity Int?
  
  // Discount
  discount     Float  @db.DoublePrecision
  discountType String @default("PERCENTAGE") @db.VarChar(20)
  price        Float? @db.DoublePrecision
  
  // Status
  isActive Boolean @default(true)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([isActive])
  @@index([minQuantity])
  
  @@map("bulk_pricing")
}// ============================================================================
// SUBSCRIPTION MODELS
// ============================================================================

enum SubscriptionStatus {
  ACTIVE
  PAUSED
  CANCELLED
  EXPIRED
  PENDING
  TRIAL
  PAST_DUE
  UNPAID
}

enum SubscriptionInterval {
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
  QUARTERLY
  SEMIANNUALLY
  YEARLY
}

model SubscriptionPlan {
  id          String  @id @default(cuid())
  productId   String?
  name        String  @db.VarChar(255)
  slug        String  @unique @db.VarChar(255)
  description String? @db.Text
  
  // Pricing
  price         Float              @db.DoublePrecision
  comparePrice  Float?             @db.DoublePrecision
  setupFee      Float              @default(0) @db.DoublePrecision
  
  // Billing
  interval      SubscriptionInterval @default(MONTHLY)
  intervalCount Int                  @default(1)
  
  // Trial
  trialDays     Int @default(0)
  trialPrice    Float? @db.DoublePrecision
  
  // Features
  features String[] @db.Text
  benefits String[] @db.Text
  
  // Limits
  productLimit    Int? // Max products per month
  downloadLimit   Int? // Max downloads
  storageLimit    Int? // Storage in MB
  
  // Discount
  discount     Float @default(0) @db.DoublePrecision
  discountType String? @db.VarChar(20)
  
  // Capacity
  maxSubscribers     Int? 
  currentSubscribers Int  @default(0)
  
  // Status
  isActive  Boolean @default(true)
  isPopular Boolean @default(false)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  product       Product?       @relation(fields: [productId], references: [id], onDelete: SetNull)
  subscriptions Subscription[]

  @@index([slug])
  @@index([productId])
  @@index([isActive])
  @@index([isPopular])
  @@index([price])
  
  @@map("subscription_plans")
}

model Subscription {
  id     String @id @default(cuid())
  userId String
  planId String
  
  // Status
  status SubscriptionStatus @default(PENDING)
  
  // Dates
  startDate          DateTime @default(now()) @db.Timestamptz(3)
  currentPeriodStart DateTime @db.Timestamptz(3)
  currentPeriodEnd   DateTime @db.Timestamptz(3)
  
  // Cancellation
  cancelAt   DateTime? @db.Timestamptz(3)
  canceledAt DateTime? @db.Timestamptz(3)
  cancelReason String? @db.Text
  
  // End
  endedAt    DateTime? @db.Timestamptz(3)
  
  // Trial
  trialStart DateTime? @db.Timestamptz(3)
  trialEnd   DateTime? @db.Timestamptz(3)
  
  // Billing
  renewalCount    Int      @default(0)
  totalPaid       Float    @default(0) @db.DoublePrecision
  nextBillingDate DateTime? @db.Timestamptz(3)
  lastBillingDate DateTime? @db.Timestamptz(3)
  
  // Payment
  paymentMethod   String? @db.VarChar(100)
  paymentMethodId String? @db.VarChar(255)
  
  // Auto Renewal
  autoRenew Boolean @default(true)
  
  // Pause
  pausedAt DateTime? @db.Timestamptz(3)
  resumeAt DateTime? @db.Timestamptz(3)
  
  // Discounts
  couponCode     String? @db.VarChar(100)
  discountAmount Float   @default(0) @db.DoublePrecision
  
  // External IDs
  stripeSubscriptionId String? @db.VarChar(255)
  externalId           String? @db.VarChar(255)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  plan SubscriptionPlan @relation(fields: [planId], references: [id])

  @@index([userId])
  @@index([planId])
  @@index([status])
  @@index([nextBillingDate])
  @@index([currentPeriodEnd])
  @@index([stripeSubscriptionId])
  
  @@map("subscriptions")
}

// ============================================================================
// GIFT CARD MODELS
// ============================================================================

enum GiftCardStatus {
  ACTIVE
  USED
  PARTIALLY_USED
  EXPIRED
  CANCELLED
  SUSPENDED
  REFUNDED
}

model GiftCard {
  id   String @id @default(cuid())
  code String @unique @db.VarChar(50)
  pin  String? @db.VarChar(20)
  
  // Amount
  amount   Float @db.DoublePrecision
  balance  Float @db.DoublePrecision
  currency String @default("INR") @db.VarChar(10)
  
  // Design
  design  String? @db.Text
  message String? @db.Text
  
  // Recipient
  issuedTo      String? @db.VarChar(50) // User ID
  issuedToEmail String? @db.VarChar(255)
  issuedToName  String? @db.VarChar(255)
  issuedToPhone String? @db.VarChar(20)
  
  // Purchaser
  purchasedBy String? @db.VarChar(50) // User ID
  
  // Status
  status GiftCardStatus @default(ACTIVE)
  
  // Activation
  activatedAt DateTime? @db.Timestamptz(3)
  
  // Expiry
  expiresAt DateTime? @db.Timestamptz(3)
  
  // Usage
  lastUsedAt DateTime? @db.Timestamptz(3)
  usageCount Int       @default(0)
  
  // Restrictions
  minPurchaseAmount Float? @db.DoublePrecision
  applicableCategories String[] @db.VarChar(50)
  excludedCategories   String[] @db.VarChar(50)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  purchases    GiftCardPurchase[]
  transactions GiftCardTransaction[]

  @@index([code])
  @@index([status])
  @@index([issuedTo])
  @@index([purchasedBy])
  @@index([expiresAt])
  @@index([balance])
  
  @@map("gift_cards")
}

model GiftCardPurchase {
  id         String @id @default(cuid())
  userId     String
  giftCardId String
  orderId    String? @db.VarChar(50)
  
  // Purchase Details
  amount       Float  @db.DoublePrecision
  purchaseType String @default("SELF") @db.VarChar(20) // SELF, GIFT
  
  // Status
  status String @default("COMPLETED") @db.VarChar(50)
  
  // Delivery
  deliveryMethod String  @default("EMAIL") @db.VarChar(50)
  deliveredAt    DateTime? @db.Timestamptz(3)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user     User     @relation(fields: [userId], references: [id])
  giftCard GiftCard @relation(fields: [giftCardId], references: [id])

  @@index([userId])
  @@index([giftCardId])
  @@index([orderId])
  @@index([status])
  
  @@map("gift_card_purchases")
}

model GiftCardTransaction {
  id         String @id @default(cuid())
  giftCardId String
  orderId    String? @db.VarChar(50)
  
  // Transaction
  amount  Float  @db.DoublePrecision
  balance Float  @db.DoublePrecision
  type    String @db.VarChar(50) // DEBIT, CREDIT, REFUND, ADJUSTMENT
  
  // Reference
  reference   String? @db.VarChar(255)
  description String? @db.Text
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  giftCard GiftCard @relation(fields: [giftCardId], references: [id], onDelete: Cascade)

  @@index([giftCardId])
  @@index([orderId])
  @@index([type])
  @@index([createdAt(sort: Desc)])
  
  @@map("gift_card_transactions")
}

// ============================================================================
// AUCTION MODELS
// ============================================================================

enum AuctionStatus {
  SCHEDULED
  LIVE
  PAUSED
  ENDED
  CANCELLED
  AWAITING_PAYMENT
}

model Auction {
  id        String @id @default(cuid())
  productId String
  
  // Auction Details
  title       String  @db.VarChar(500)
  description String? @db.Text
  
  // Pricing
  startingPrice Float  @db.DoublePrecision
  reservePrice  Float? @db.DoublePrecision
  currentBid    Float? @db.DoublePrecision
  buyNowPrice   Float? @db.DoublePrecision
  
  // Bidding
  bidIncrement Float @default(10) @db.DoublePrecision
  minBidIncrement Float? @db.DoublePrecision
  
  // Timing
  startTime DateTime @db.Timestamptz(3)
  endTime   DateTime @db.Timestamptz(3)
  
  // Auto Extension
  autoExtend    Boolean @default(true)
  extendMinutes Int     @default(5)
  extendedCount Int     @default(0)
  
  // Status
  status AuctionStatus @default(SCHEDULED)
  
  // Winner
  winnerId      String? @db.VarChar(50)
  winningBid    Float?  @db.DoublePrecision
  winnerNotified Boolean @default(false)
  
  // Statistics
  totalBids  Int @default(0)
  viewCount  Int @default(0)
  watchCount Int @default(0)
  
  // Features
  featured      Boolean @default(false)
  allowProxyBid Boolean @default(true)
  
  // Shipping
  shippingCost Float? @db.DoublePrecision
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  product  Product        @relation(fields: [productId], references: [id], onDelete: Cascade)
  bids     Bid[]
  watchers AuctionWatch[]

  @@index([productId])
  @@index([status])
  @@index([endTime])
  @@index([startTime])
  @@index([featured])
  @@index([currentBid])
  
  @@map("auctions")
}

model Bid {
  id        String @id @default(cuid())
  auctionId String
  userId    String @db.VarChar(50)
  
  // Bid Details
  amount    Float   @db.DoublePrecision
  isWinning Boolean @default(false)
  
  // Proxy Bidding
  isAutoBid Boolean @default(false)
  maxBid    Float?  @db.DoublePrecision
  
  // Outbid Status
  isOutbid   Boolean   @default(false)
  outbidAt   DateTime? @db.Timestamptz(3)
  
  // Device
  ipAddress String? @db.VarChar(45)
  userAgent String? @db.Text
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  auction Auction @relation(fields: [auctionId], references: [id], onDelete: Cascade)

  @@index([auctionId])
  @@index([userId])
  @@index([isWinning])
  @@index([createdAt(sort: Desc)])
  
  @@map("bids")
}

model AuctionWatch {
  id        String @id @default(cuid())
  auctionId String
  userId    String @db.VarChar(50)
  
  // Notifications
  notifyOnBid    Boolean @default(true)
  notifyOnOutbid Boolean @default(true)
  notifyOnEnd    Boolean @default(true)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  auction Auction @relation(fields: [auctionId], references: [id], onDelete: Cascade)

  @@unique([auctionId, userId])
  @@index([auctionId])
  @@index([userId])
  
  @@map("auction_watchers")
}

// ============================================================================
// RENTAL MODELS
// ============================================================================

enum RentalStatus {
  PENDING
  APPROVED
  ACTIVE
  RETURNED
  LATE
  DAMAGED
  CANCELLED
  COMPLETED
}

model RentalProduct {
  id        String @id @default(cuid())
  productId String
  
  // Rental Rates
  dailyRate   Float  @db.DoublePrecision
  weeklyRate  Float? @db.DoublePrecision
  monthlyRate Float? @db.DoublePrecision
  
  // Deposit
  securityDeposit Float @db.DoublePrecision
  
  // Rental Period
  minRentalDays Int @default(1)
  maxRentalDays Int?
  
  // Inventory
  availableUnits Int @default(1)
  totalUnits     Int @default(1)
  rentedUnits    Int @default(0)
  
  // Status
  isActive Boolean @default(true)
  
  // Terms
  terms           String? @db.Text
  damagePolicy    String? @db.Text
  lateReturnFee   Float?  @db.DoublePrecision
  cleaningFee     Float?  @db.DoublePrecision
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  product Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  rentals Rental[]

  @@index([productId])
  @@index([isActive])
  @@index([availableUnits])
  
  @@map("rental_products")
}

model Rental {
  id              String @id @default(cuid())
  rentalProductId String
  userId          String @db.VarChar(50)
  orderId         String? @db.VarChar(50)
  
  // Rental Period
  startDate DateTime @db.Timestamptz(3)
  endDate   DateTime @db.Timestamptz(3)
  
  // Return
  actualReturnDate DateTime? @db.Timestamptz(3)
  isLate           Boolean   @default(false)
  lateDays         Int       @default(0)
  
  // Costs
  rentalCost      Float @db.DoublePrecision
  depositPaid     Float @db.DoublePrecision
  depositRefunded Float @default(0) @db.DoublePrecision
  lateFee         Float @default(0) @db.DoublePrecision
  damageFee       Float @default(0) @db.DoublePrecision
  cleaningFee     Float @default(0) @db.DoublePrecision
  totalCost       Float @db.DoublePrecision
  
  // Status
  status RentalStatus @default(PENDING)
  
  // Condition
  conditionAtRental String? @db.Text
  conditionAtReturn String? @db.Text
  
  // Damage
  hasDamage       Boolean @default(false)
  damageReport    String? @db.Text
  damageImages    String[] @db.Text
  
  // Notes
  notes         String? @db.Text
  internalNotes String? @db.Text
  
  // Inspection
  inspectedAt DateTime? @db.Timestamptz(3)
  inspectedBy String?   @db.VarChar(50)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  rentalProduct RentalProduct @relation(fields: [rentalProductId], references: [id])
  user          User          @relation(fields: [userId], references: [id])

  @@index([rentalProductId])
  @@index([userId])
  @@index([orderId])
  @@index([status])
  @@index([startDate, endDate])
  @@index([actualReturnDate])
  
  @@map("rentals")
}

// ============================================================================
// INSURANCE MODELS
// ============================================================================

enum InsuranceStatus {
  ACTIVE
  EXPIRED
  CANCELLED
  CLAIMED
  SUSPENDED
}

model ProductInsurance {
  id        String @id @default(cuid())
  productId String
  
  // Insurance Details
  name        String  @db.VarChar(255)
  description String? @db.Text
  provider    String  @db.VarChar(255)
  
  // Coverage
  coverage Json @db.JsonB
  
  // Pricing
  premium  Float @db.DoublePrecision
  deductible Float @default(0) @db.DoublePrecision
  
  // Duration
  duration     Int    @default(12) // months
  durationType String @default("MONTHS") @db.VarChar(20)
  
  // Terms
  terms           String? @db.Text
  exclusions      String? @db.Text
  claimProcess    String? @db.Text
  
  // Limits
  maxClaimAmount  Float? @db.DoublePrecision
  maxClaims       Int?   @default(3)
  
  // Status
  isActive Boolean @default(true)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  product   Product             @relation(fields: [productId], references: [id], onDelete: Cascade)
  purchases InsurancePurchase[]

  @@index([productId])
  @@index([isActive])
  @@index([provider])
  
  @@map("product_insurance")
}

model InsurancePurchase {
  id          String @id @default(cuid())
  insuranceId String
  userId      String @db.VarChar(50)
  orderId     String @db.VarChar(50)
  orderItemId String @db.VarChar(50)
  
  // Policy Details
  policyNumber String @unique @db.VarChar(100)
  
  // Coverage Period
  startDate DateTime @db.Timestamptz(3)
  endDate   DateTime @db.Timestamptz(3)
  
  // Premium
  premium      Float @db.DoublePrecision
  paymentMode  String @default("ONE_TIME") @db.VarChar(50)
  
  // Status
  status InsuranceStatus @default(ACTIVE)
  
  // Claims
  claimsMade     Int   @default(0)
  claimsApproved Int   @default(0)
  claimsRejected Int   @default(0)
  totalClaimAmount Float @default(0) @db.DoublePrecision
  
  // Documents
  policyDocument String? @db.Text
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  insurance ProductInsurance @relation(fields: [insuranceId], references: [id])
  user      User             @relation(fields: [userId], references: [id])
  claims    InsuranceClaim[]

  @@index([insuranceId])
  @@index([userId])
  @@index([orderId])
  @@index([orderItemId])
  @@index([policyNumber])
  @@index([status])
  @@index([startDate, endDate])
  
  @@map("insurance_purchases")
}

model InsuranceClaim {
  id         String @id @default(cuid())
  purchaseId String
  
  // Claim Details
  claimNumber String  @unique @db.VarChar(100)
  claimType   String  @db.VarChar(100)
  description String  @db.Text
  claimAmount Float   @db.DoublePrecision
  
  // Supporting Documents
  documents String[] @db.Text
  photos    String[] @db.Text
  
  // Status
  status String @default("SUBMITTED") @db.VarChar(50)
  
  // Processing
  submittedAt DateTime  @default(now()) @db.Timestamptz(3)
  reviewedAt  DateTime? @db.Timestamptz(3)
  reviewedBy  String?   @db.VarChar(50)
  approvedAt  DateTime? @db.Timestamptz(3)
  rejectedAt  DateTime? @db.Timestamptz(3)
  
  // Settlement
  approvedAmount Float?    @db.DoublePrecision
  paidAmount     Float?    @db.DoublePrecision
  paidAt         DateTime? @db.Timestamptz(3)
  
  // Rejection
  rejectionReason String? @db.Text
  
  // Notes
  notes         String? @db.Text
  internalNotes String? @db.Text
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  purchase InsurancePurchase @relation(fields: [purchaseId], references: [id])

  @@index([purchaseId])
  @@index([claimNumber])
  @@index([status])
  @@index([submittedAt(sort: Desc)])
  
  @@map("insurance_claims")
}

// ============================================================================
// INSTALLMENT & BNPL MODELS
// ============================================================================

enum InstallmentStatus {
  ACTIVE
  COMPLETED
  DEFAULTED
  CANCELLED
  RESTRUCTURED
}

model InstallmentPlan {
  id          String  @id @default(cuid())
  name        String  @db.VarChar(255)
  description String? @db.Text
  provider    String  @db.VarChar(100)
  
  // Eligibility
  minAmount Float  @db.DoublePrecision
  maxAmount Float? @db.DoublePrecision
  
  // Terms
  tenure       Int   @default(3) // months
  interestRate Float @default(0) @db.DoublePrecision
  processingFee Float @default(0) @db.DoublePrecision
  
  // Late Payment
  lateFeeAmount     Float? @db.DoublePrecision
  lateFeePercentage Float? @db.DoublePrecision
  gracePeriodDays   Int    @default(3)
  
  // Status
  isActive Boolean @default(true)
  
  // Terms & Conditions
  terms String? @db.Text
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  purchases InstallmentPurchase[]

  @@index([isActive])
  @@index([provider])
  @@index([minAmount, maxAmount])
  
  @@map("installment_plans")
}

model InstallmentPurchase {
  id      String @id @default(cuid())
  planId  String
  userId  String @db.VarChar(50)
  orderId String @db.VarChar(50)
  
  // Amounts
  totalAmount     Float @db.DoublePrecision
  downPayment     Float @db.DoublePrecision
  emiAmount       Float @db.DoublePrecision
  remainingAmount Float @db.DoublePrecision
  
  // Interest & Fees
  totalInterest  Float @default(0) @db.DoublePrecision
  processingFee  Float @default(0) @db.DoublePrecision
  totalLateFees  Float @default(0) @db.DoublePrecision
  
  // Tenure
  tenure           Int @default(3)
  paidInstallments Int @default(0)
  
  // Status
  status InstallmentStatus @default(ACTIVE)
  
  // Dates
  nextDueDate DateTime  @db.Timestamptz(3)
  lastPaidAt  DateTime? @db.Timestamptz(3)
  completedAt DateTime? @db.Timestamptz(3)
  
  // Auto-debit
  autoDebit       Boolean @default(false)
  paymentMethodId String? @db.VarChar(255)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  plan         InstallmentPlan @relation(fields: [planId], references: [id])
  user         User            @relation(fields: [userId], references: [id])
  installments Installment[]

  @@index([planId])
  @@index([userId])
  @@index([orderId])
  @@index([status])
  @@index([nextDueDate])
  
  @@map("installment_purchases")
}

model Installment {
  id         String @id @default(cuid())
  purchaseId String
  
  // Installment Details
  installmentNumber Int
  dueDate           DateTime @db.Timestamptz(3)
  amount            Float    @db.DoublePrecision
  
  // Payment
  paidAmount Float   @default(0) @db.DoublePrecision
  paidAt     DateTime? @db.Timestamptz(3)
  paymentId  String?   @db.VarChar(255)
  
  // Status
  status String @default("PENDING") @db.VarChar(50) // PENDING, PAID, OVERDUE, DEFAULTED
  
  // Late Payment
  lateFee     Float   @default(0) @db.DoublePrecision
  daysOverdue Int     @default(0)
  
  // Reminders
  remindersSent Int @default(0)
  lastReminderAt DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  purchase InstallmentPurchase @relation(fields: [purchaseId], references: [id], onDelete: Cascade)

  @@unique([purchaseId, installmentNumber])
  @@index([purchaseId])
  @@index([status])
  @@index([dueDate])
  @@index([installmentNumber])
  
  @@map("installments")
}

// ============================================================================
// PRE-ORDER & WAITLIST MODELS
// ============================================================================

enum PreOrderStatus {
  PENDING
  CONFIRMED
  PRODUCTION
  READY_TO_SHIP
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

model PreOrder {
  id        String @id @default(cuid())
  userId    String
  productId String
  variantId String? @db.VarChar(50)
  
  // Quantity & Pricing
  quantity    Int   @default(1)
  price       Float @db.DoublePrecision
  totalAmount Float @db.DoublePrecision
  
  // Deposit
  depositAmount    Float?    @db.DoublePrecision
  depositPaid      Boolean   @default(false)
  depositPaidAt    DateTime? @db.Timestamptz(3)
  depositRefunded  Boolean   @default(false)
  
  // Estimated Dates
  estimatedShipDate    DateTime  @db.Date
  estimatedDeliveryDate DateTime? @db.Date
  
  // Status
  status PreOrderStatus @default(PENDING)
  
  // Notifications
  notified Boolean @default(false)
  notifiedAt DateTime? @db.Timestamptz(3)
  
  // Fulfillment
  fulfilledAt DateTime? @db.Timestamptz(3)
  orderId     String?   @db.VarChar(50)
  
  // Cancellation
  cancelledAt     DateTime? @db.Timestamptz(3)
  cancellationReason String? @db.Text
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user    User    @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([productId])
  @@index([variantId])
  @@index([status])
  @@index([estimatedShipDate])
  
  @@map("pre_orders")
}

model Waitlist {
  id        String  @id @default(cuid())
  userId    String
  productId String
  variantId String? @db.VarChar(50)
  
  // Contact
  email String  @db.VarChar(255)
  phone String? @db.VarChar(20)
  
  // Notification Preferences
  notifyEmail Boolean @default(true)
  notifySms   Boolean @default(false)
  notifyPush  Boolean @default(true)
  
  // Status
  notified   Boolean   @default(false)
  notifiedAt DateTime? @db.Timestamptz(3)
  
  // Priority (for exclusive launches)
  priority Int @default(0)
  
  // Converted
  converted   Boolean   @default(false)
  convertedAt DateTime? @db.Timestamptz(3)
  orderId     String?   @db.VarChar(50)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId, variantId])
  @@index([userId])
  @@index([productId])
  @@index([variantId])
  @@index([notified])
  @@index([converted])
  @@index([priority(sort: Desc)])
  
  @@map("waitlists")
}

model ProductReservation {
  id        String @id @default(cuid())
  productId String
  variantId String? @db.VarChar(50)
  userId    String @db.VarChar(50)
  
  // Reservation Details
  quantity Int @default(1)
  
  // Expiry
  expiresAt DateTime @db.Timestamptz(3)
  
  // Status
  status String @default("ACTIVE") @db.VarChar(50) // ACTIVE, EXPIRED, CONVERTED, CANCELLED
  
  // Conversion
  convertedToOrder String?   @db.VarChar(50)
  convertedAt      DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([variantId])
  @@index([userId])
  @@index([status])
  @@index([expiresAt])
  
  @@map("product_reservations")
}// ============================================================================
// LIVE SHOPPING & STREAMING MODELS
// ============================================================================

enum LiveSessionStatus {
  SCHEDULED
  LIVE
  PAUSED
  ENDED
  CANCELLED
}

model LiveSession {
  id       String @id @default(cuid())
  hostId   String
  title    String @db.VarChar(500)
  description String? @db.Text
  
  // Media
  thumbnail String? @db.Text
  banner    String? @db.Text
  
  // Streaming
  streamUrl    String? @db.Text
  streamKey    String? @db.VarChar(255)
  playbackUrl  String? @db.Text
  rtmpUrl      String? @db.Text
  
  // Status
  status LiveSessionStatus @default(SCHEDULED)
  
  // Timing
  scheduledAt DateTime  @db.Timestamptz(3)
  startedAt   DateTime? @db.Timestamptz(3)
  endedAt     DateTime? @db.Timestamptz(3)
  duration    Int?      // in seconds
  
  // Engagement
  viewCount       Int   @default(0)
  peakViewers     Int   @default(0)
  uniqueViewers   Int   @default(0)
  totalWatchTime  Int   @default(0) // in seconds
  averageWatchTime Float @default(0) @db.DoublePrecision
  
  // Commerce
  productIds   String[] @db.VarChar(50)
  totalRevenue Float    @default(0) @db.DoublePrecision
  totalOrders  Int      @default(0)
  conversionRate Float  @default(0) @db.DoublePrecision
  
  // Features
  isRecorded   Boolean @default(true)
  recordingUrl String? @db.Text
  allowChat    Boolean @default(true)
  allowPolls   Boolean @default(true)
  allowGifts   Boolean @default(false)
  
  // Moderation
  moderatorIds String[] @db.VarChar(50)
  bannedUsers  String[] @db.VarChar(50)
  
  // Settings
  isPrivate      Boolean  @default(false)
  password       String?  @db.VarChar(255)
  maxViewers     Int?
  chatRateLimit  Int?     @default(5) // messages per minute
  
  // SEO
  tags String[] @db.VarChar(100)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  host         User           @relation(fields: [hostId], references: [id])
  viewers      LiveViewer[]
  messages     ChatMessage[]
  polls        LivePoll[]
  products     LiveProduct[]
  highlights   LiveHighlight[]

  @@index([hostId])
  @@index([status])
  @@index([scheduledAt])
  @@index([startedAt])
  @@index([viewCount(sort: Desc)])
  @@index([tags])
  
  @@map("live_sessions")
}

model LiveViewer {
  id        String  @id @default(cuid())
  sessionId String
  userId    String? @db.VarChar(50)
  sessionToken String? @db.VarChar(255)
  
  // Viewing
  joinedAt  DateTime @default(now()) @db.Timestamptz(3)
  leftAt    DateTime? @db.Timestamptz(3)
  watchTime Int      @default(0) // in seconds
  
  // Engagement
  messagesPosted Int     @default(0)
  reactionsGiven Int     @default(0)
  purchased      Boolean @default(false)
  purchaseAmount Float   @default(0) @db.DoublePrecision
  
  // Device
  deviceType String? @db.VarChar(50)
  userAgent  String? @db.Text
  ipAddress  String? @db.VarChar(45)
  
  // Metadata
  metadata Json? @db.JsonB
  
  // Relations
  session LiveSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([userId])
  @@index([joinedAt])
  @@index([purchased])
  
  @@map("live_viewers")
}

model LiveProduct {
  id        String @id @default(cuid())
  sessionId String
  productId String @db.VarChar(50)
  
  // Display
  displayOrder Int     @default(0)
  isHighlighted Boolean @default(false)
  
  // Pricing (can be special for live)
  livePrice     Float? @db.DoublePrecision
  discount      Float? @db.DoublePrecision
  
  // Inventory
  stockAllocated Int? 
  soldCount      Int @default(0)
  
  // Timing
  featuredAt DateTime? @db.Timestamptz(3)
  removedAt  DateTime? @db.Timestamptz(3)
  
  // Timestamp
  addedAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  session LiveSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, productId])
  @@index([sessionId])
  @@index([productId])
  @@index([displayOrder])
  
  @@map("live_products")
}

model ChatMessage {
  id        String @id @default(cuid())
  sessionId String
  userId    String
  
  // Message
  message String @db.Text
  type    String @default("TEXT") @db.VarChar(20) // TEXT, EMOJI, STICKER, SYSTEM
  
  // Features
  isHighlighted Boolean @default(false)
  isPinned      Boolean @default(false)
  isDeleted     Boolean @default(false)
  deletedAt     DateTime? @db.Timestamptz(3)
  
  // Reactions
  reactions Json? @db.JsonB
  
  // Reply
  replyToId String? @db.VarChar(50)
  
  // Moderation
  isFlagged    Boolean @default(false)
  flaggedAt    DateTime? @db.Timestamptz(3)
  flagReason   String? @db.Text
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  session LiveSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  user    User        @relation(fields: [userId], references: [id])

  @@index([sessionId])
  @@index([userId])
  @@index([createdAt(sort: Desc)])
  @@index([isPinned])
  @@index([isHighlighted])
  
  @@map("chat_messages")
}

model LivePoll {
  id        String @id @default(cuid())
  sessionId String
  
  // Poll Details
  question String  @db.VarChar(500)
  options  Json[]  @db.JsonB
  
  // Settings
  allowMultiple Boolean @default(false)
  isAnonymous   Boolean @default(false)
  
  // Timing
  endTime  DateTime? @db.Timestamptz(3)
  isActive Boolean   @default(true)
  
  // Results
  totalVotes Int  @default(0)
  results    Json? @db.JsonB
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  session LiveSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  votes   PollVote[]

  @@index([sessionId])
  @@index([isActive])
  @@index([createdAt(sort: Desc)])
  
  @@map("live_polls")
}

model PollVote {
  id     String @id @default(cuid())
  pollId String
  userId String
  
  // Vote
  options Int[] // Array of option indices
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  poll LivePoll @relation(fields: [pollId], references: [id], onDelete: Cascade)
  user User     @relation(fields: [userId], references: [id])

  @@unique([pollId, userId])
  @@index([pollId])
  @@index([userId])
  
  @@map("poll_votes")
}

model LiveHighlight {
  id        String @id @default(cuid())
  sessionId String
  
  // Highlight Details
  title       String  @db.VarChar(255)
  description String? @db.Text
  
  // Timing
  startTime Int // seconds from session start
  endTime   Int
  
  // Media
  thumbnailUrl String? @db.Text
  clipUrl      String? @db.Text
  
  // Engagement
  viewCount Int @default(0)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  session LiveSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
  @@index([viewCount(sort: Desc)])
  
  @@map("live_highlights")
}

// ============================================================================
// AR/VR & 3D MODELS
// ============================================================================

enum ARModelStatus {
  PROCESSING
  READY
  FAILED
  ARCHIVED
}

model AR3DModel {
  id        String @id @default(cuid())
  productId String
  
  // Model Details
  modelUrl  String @db.Text
  format    String @default("GLTF") @db.VarChar(20) // GLTF, GLB, USDZ, FBX
  fileSize  Int    // in bytes
  
  // Preview
  thumbnail  String? @db.Text
  previewGif String? @db.Text
  
  // Transformations
  scale    Json? @db.JsonB
  position Json? @db.JsonB
  rotation Json? @db.JsonB
  
  // iOS AR Quick Look
  usdzUrl String? @db.Text
  
  // Android AR Core
  glbUrl String? @db.Text
  
  // Status
  status   ARModelStatus @default(PROCESSING)
  isActive Boolean       @default(true)
  
  // Engagement
  viewCount Int @default(0)
  tryOnCount Int @default(0)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([status])
  @@index([isActive])
  @@index([format])
  
  @@map("ar_3d_models")
}

model VirtualTryOn {
  id        String @id @default(cuid())
  userId    String
  productId String
  
  // Try-On Type
  type String @default("AR") @db.VarChar(20) // AR, VR, AI_GENERATED
  
  // Session Data
  sessionData Json @db.JsonB
  
  // Snapshots
  snapshots String[] @db.Text
  
  // Duration
  duration Int? // in seconds
  
  // Actions
  purchased Boolean @default(false)
  shared    Boolean @default(false)
  saved     Boolean @default(false)
  
  // Device
  deviceType String? @db.VarChar(50)
  platform   String? @db.VarChar(50)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user    User    @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([productId])
  @@index([type])
  @@index([purchased])
  @@index([createdAt(sort: Desc)])
  
  @@map("virtual_try_ons")
}

// ============================================================================
// VOICE COMMERCE MODELS
// ============================================================================

model VoiceSearch {
  id     String @id @default(cuid())
  userId String
  
  // Query
  query         String  @db.Text
  audioUrl      String? @db.Text
  transcription String? @db.Text
  
  // AI Analysis
  intent     String? @db.VarChar(100)
  entities   Json?   @db.JsonB
  confidence Float?  @db.DoublePrecision
  
  // Results
  resultCount Int @default(0)
  
  // Success
  success Boolean @default(false)
  
  // Language
  language String @default("en") @db.VarChar(10)
  
  // Duration
  duration Int? // in milliseconds
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([intent])
  @@index([language])
  @@index([createdAt(sort: Desc)])
  @@fulltext([query, transcription])
  
  @@map("voice_searches")
}

model VoiceCommand {
  id     String  @id @default(cuid())
  userId String? @db.VarChar(50)
  
  // Command
  command String @db.Text
  action  String @db.VarChar(100)
  
  // Parameters
  parameters Json? @db.JsonB
  
  // Execution
  success  Boolean @default(false)
  response String? @db.Text
  
  // Audio
  audioUrl String? @db.Text
  
  // Duration
  duration Int? // in milliseconds
  
  // Device
  deviceType String? @db.VarChar(50)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([userId])
  @@index([action])
  @@index([success])
  @@index([createdAt(sort: Desc)])
  
  @@map("voice_commands")
}

// ============================================================================
// WEB3 & BLOCKCHAIN MODELS
// ============================================================================

enum BlockchainNetwork {
  ETHEREUM
  POLYGON
  BINANCE_SMART_CHAIN
  SOLANA
  AVALANCHE
  ARBITRUM
  OPTIMISM
}

model NFTCertificate {
  id        String @id @default(cuid())
  productId String
  
  // NFT Details
  tokenId         String            @unique @db.VarChar(255)
  contractAddress String            @db.VarChar(255)
  blockchain      BlockchainNetwork @default(ETHEREUM)
  
  // Metadata
  metadataUri String @db.Text
  
  // Ownership
  ownerAddress String  @db.VarChar(255)
  mintedBy     String? @db.VarChar(50) // User ID
  
  // Minting
  mintedAt    DateTime  @db.Timestamptz(3)
  txHash      String?   @db.VarChar(255)
  blockNumber Int?
  
  // Transfer History
  transferCount Int @default(0)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  product Product @relation(fields: [productId], references: [id])

  @@index([productId])
  @@index([tokenId])
  @@index([ownerAddress])
  @@index([contractAddress])
  @@index([blockchain])
  
  @@map("nft_certificates")
}

model NFTOwnership {
  id     String @id @default(cuid())
  userId String
  
  // NFT Details
  tokenId         String            @db.VarChar(255)
  contractAddress String            @db.VarChar(255)
  blockchain      BlockchainNetwork @default(ETHEREUM)
  
  // Quantity (for ERC-1155)
  quantity Int @default(1)
  
  // Acquisition
  acquiredAt DateTime @default(now()) @db.Timestamptz(3)
  acquiredFrom String? @db.VarChar(255) // Address
  purchasePrice Float? @db.DoublePrecision
  
  // Current Status
  isListed Boolean @default(false)
  listPrice Float? @db.DoublePrecision
  
  // Metadata
  metadata Json? @db.JsonB
  
  // Relations
  user User @relation(fields: [userId], references: [id])

  @@unique([userId, tokenId, contractAddress])
  @@index([userId])
  @@index([tokenId])
  @@index([contractAddress])
  @@index([blockchain])
  
  @@map("nft_ownerships")
}

model CryptoPayment {
  id      String  @id @default(cuid())
  userId  String
  orderId String? @db.VarChar(50)
  
  // Cryptocurrency
  cryptocurrency String            @db.VarChar(50)
  network        BlockchainNetwork @default(ETHEREUM)
  
  // Amounts
  amount         Float @db.DoublePrecision
  amountInCrypto Float @db.DoublePrecision
  
  // Addresses
  walletAddress   String @db.VarChar(255)
  depositAddress  String @db.VarChar(255)
  
  // Transaction
  transactionHash String  @unique @db.VarChar(255)
  blockNumber     Int?
  confirmations   Int     @default(0)
  
  // Status
  status String @default("PENDING") @db.VarChar(50)
  
  // Confirmation
  confirmedAt DateTime? @db.Timestamptz(3)
  
  // Exchange Rate
  exchangeRate Float @db.DoublePrecision
  
  // Fee
  feeAmount   Float @default(0) @db.DoublePrecision
  feeCurrency String @default("USD") @db.VarChar(10)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([orderId])
  @@index([transactionHash])
  @@index([status])
  @@index([network])
  
  @@map("crypto_payments")
}

model WalletTransaction {
  id     String @id @default(cuid())
  userId String
  
  // Transaction Type
  type String @db.VarChar(50) // DEPOSIT, WITHDRAWAL, TRANSFER, PURCHASE, REFUND
  
  // Amount
  amount   Float  @db.DoublePrecision
  currency String @default("MATIC") @db.VarChar(20)
  
  // Addresses
  fromAddress String? @db.VarChar(255)
  toAddress   String? @db.VarChar(255)
  
  // Blockchain
  txHash      String? @unique @db.VarChar(255)
  blockNumber Int?
  network     BlockchainNetwork? @default(POLYGON)
  
  // Status
  status String @default("PENDING") @db.VarChar(50)
  
  // Reference
  reference   String? @db.VarChar(255)
  description String? @db.Text
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([type])
  @@index([status])
  @@index([txHash])
  @@index([createdAt(sort: Desc)])
  
  @@map("wallet_transactions")
}

model SmartContract {
  id      String @id @default(cuid())
  name    String @db.VarChar(255)
  type    String @db.VarChar(100)
  
  // Contract Details
  address    String            @unique @db.VarChar(255)
  blockchain BlockchainNetwork @default(ETHEREUM)
  
  // ABI
  abi Json @db.JsonB
  
  // Deployment
  deployer   String   @db.VarChar(255)
  deployedAt DateTime @db.Timestamptz(3)
  txHash     String?  @db.VarChar(255)
  
  // Status
  isActive   Boolean @default(true)
  isVerified Boolean @default(false)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([address])
  @@index([blockchain])
  @@index([type])
  @@index([isActive])
  
  @@map("smart_contracts")
}

model DAOProposal {
  id          String @id @default(cuid())
  title       String @db.VarChar(500)
  description String @db.Text
  proposer    String @db.VarChar(255) // Wallet address
  proposerId  String @db.VarChar(50) // User ID
  
  // Type
  type     String  @db.VarChar(100)
  category String? @db.VarChar(100)
  
  // Voting
  votesFor     Int @default(0)
  votesAgainst Int @default(0)
  votesAbstain Int @default(0)
  
  // Thresholds
  quorum    Int   @default(100)
  threshold Float @default(0.5) @db.DoublePrecision
  
  // Status
  status String @default("ACTIVE") @db.VarChar(50)
  
  // Timing
  startTime DateTime @db.Timestamptz(3)
  endTime   DateTime @db.Timestamptz(3)
  
  // Execution
  executed   Boolean   @default(false)
  executedAt DateTime? @db.Timestamptz(3)
  executedBy String?   @db.VarChar(255)
  txHash     String?   @db.VarChar(255)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user  User      @relation(fields: [proposerId], references: [id])
  votes DAOVote[]

  @@index([proposerId])
  @@index([proposer])
  @@index([status])
  @@index([type])
  @@index([endTime])
  
  @@map("dao_proposals")
}

model DAOVote {
  id         String @id @default(cuid())
  proposalId String
  voter      String @db.VarChar(255) // Wallet address
  voterId    String @db.VarChar(50) // User ID
  
  // Vote
  vote   String @db.VarChar(20) // FOR, AGAINST, ABSTAIN
  weight Float  @default(1) @db.DoublePrecision
  
  // Reason
  reason String? @db.Text
  
  // Blockchain
  txHash      String? @db.VarChar(255)
  blockNumber Int?
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  proposal DAOProposal @relation(fields: [proposalId], references: [id], onDelete: Cascade)
  user     User        @relation(fields: [voterId], references: [id])

  @@unique([proposalId, voter])
  @@index([proposalId])
  @@index([voterId])
  @@index([voter])
  @@index([vote])
  
  @@map("dao_votes")
}

model TokenStaking {
  id            String @id @default(cuid())
  userId        String
  walletAddress String @db.VarChar(255)
  
  // Staking Details
  tokenAmount Float  @db.DoublePrecision
  tokenSymbol String @db.VarChar(20)
  
  // Returns
  apy      Float @db.DoublePrecision
  duration Int   // in days
  
  // Lock Period
  lockPeriod Int? // in days
  
  // Dates
  startDate DateTime @default(now()) @db.Timestamptz(3)
  endDate   DateTime @db.Timestamptz(3)
  
  // Rewards
  rewards      Float   @default(0) @db.DoublePrecision
  claimed      Boolean @default(false)
  claimedAt    DateTime? @db.Timestamptz(3)
  autoCompound Boolean @default(false)
  
  // Status
  status String @default("ACTIVE") @db.VarChar(50)
  
  // Blockchain
  txHash String? @db.VarChar(255)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([walletAddress])
  @@index([status])
  @@index([endDate])
  
  @@map("token_stakings")
}

model GovernanceToken {
  id            String @id @default(cuid())
  userId        String
  walletAddress String @db.VarChar(255)
  
  // Balance
  balance Float @db.DoublePrecision
  locked  Float @default(0) @db.DoublePrecision
  
  // Delegation
  delegatedTo String? @db.VarChar(255)
  
  // Voting Power
  votingPower Float @db.DoublePrecision
  
  // Last Update
  lastUpdated DateTime @default(now()) @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id])

  @@unique([userId, walletAddress])
  @@index([userId])
  @@index([walletAddress])
  @@index([delegatedTo])
  @@index([votingPower(sort: Desc)])
  
  @@map("governance_tokens")
}

// ============================================================================
// SOCIAL FEATURES
// ============================================================================

model SocialShare {
  id        String         @id @default(cuid())
  userId    String
  productId String
  platform  SocialPlatform
  
  // Share Details
  shareUrl String? @db.Text
  message  String? @db.Text
  
  // Engagement
  clicks      Int @default(0)
  conversions Int @default(0)
  revenue     Float @default(0) @db.DoublePrecision
  
  // Timestamp
  sharedAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([productId])
  @@index([platform])
  @@index([sharedAt(sort: Desc)])
  
  @@map("social_shares")
}

enum SocialPlatform {
  FACEBOOK
  TWITTER
  INSTAGRAM
  WHATSAPP
  TELEGRAM
  LINKEDIN
  PINTEREST
  YOUTUBE
  TIKTOK
  SNAPCHAT
  REDDIT
  DISCORD
}

model UserStory {
  id     String @id @default(cuid())
  userId String
  
  // Content
  type       String  @default("IMAGE") @db.VarChar(20) // IMAGE, VIDEO
  mediaUrl   String  @db.Text
  thumbnail  String? @db.Text
  caption    String? @db.Text
  
  // Products Tagged
  productIds String[] @db.VarChar(50)
  
  // Duration
  duration Int @default(24) // in hours
  
  // Engagement
  viewCount  Int @default(0)
  likeCount  Int @default(0)
  shareCount Int @default(0)
  
  // Privacy
  isPublic Boolean @default(true)
  
  // Expiry
  expiresAt DateTime @db.Timestamptz(3)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
  @@index([isPublic])
  @@index([createdAt(sort: Desc)])
  
  @@map("user_stories")
}

// ============================================================================
// INFLUENCER & AFFILIATE MODELS
// ============================================================================

enum InfluencerTier {
  NANO
  MICRO
  MACRO
  MEGA
}

model InfluencerProfile {
  id       String @id @default(cuid())
  userId   String @unique
  username String @unique @db.VarChar(100)
  
  // Bio
  bio         String? @db.Text
  website     String? @db.VarChar(500)
  
  // Social Platforms
  platforms Json @db.JsonB
  
  // Metrics
  followers      Int   @default(0)
  engagement     Float @default(0) @db.DoublePrecision
  averageLikes   Int   @default(0)
  averageComments Int  @default(0)
  
  // Niche
  niche      String[] @db.VarChar(100)
  categories String[] @db.VarChar(100)
  
  // Commission
  commission  Float @default(5.0) @db.DoublePrecision
  totalEarned Float @default(0) @db.DoublePrecision
  
  // Verification
  isVerified Boolean @default(false)
  verifiedAt DateTime? @db.Timestamptz(3)
  
  // Status
  isActive Boolean @default(true)
  tier     InfluencerTier @default(NANO)
  
  // Performance
  totalClicks      Int   @default(0)
  totalConversions Int   @default(0)
  conversionRate   Float @default(0) @db.DoublePrecision
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user      User                 @relation(fields: [userId], references: [id])
  campaigns InfluencerCampaign[]

  @@index([userId])
  @@index([username])
  @@index([isVerified])
  @@index([tier])
  @@index([followers(sort: Desc)])
  
  @@map("influencer_profiles")
}

model InfluencerCampaign {
  id           String @id @default(cuid())
  influencerId String
  name         String @db.VarChar(255)
  description  String? @db.Text
  
  // Products
  productIds String[] @db.VarChar(50)
  
  // Commission
  commission     Float @db.DoublePrecision
  commissionType String @default("PERCENTAGE") @db.VarChar(20)
  
  // Duration
  startDate DateTime @db.Timestamptz(3)
  endDate   DateTime @db.Timestamptz(3)
  
  // Budget
  budget Float? @db.DoublePrecision
  spent  Float  @default(0) @db.DoublePrecision
  
  // Performance
  clicks      Int   @default(0)
  conversions Int   @default(0)
  revenue     Float @default(0) @db.DoublePrecision
  
  // Status
  status String @default("ACTIVE") @db.VarChar(50)
  
  // Tracking
  trackingCode String @unique @db.VarChar(100)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  influencer InfluencerProfile           @relation(fields: [influencerId], references: [id])
  products   InfluencerCampaignProduct[]

  @@index([influencerId])
  @@index([trackingCode])
  @@index([status])
  @@index([startDate, endDate])
  
  @@map("influencer_campaigns")
}

model InfluencerCampaignProduct {
  id         String @id @default(cuid())
  campaignId String
  productId  String
  
  // Performance
  clicks      Int   @default(0)
  conversions Int   @default(0)
  revenue     Float @default(0) @db.DoublePrecision
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  campaign InfluencerCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  product  Product            @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([campaignId, productId])
  @@index([campaignId])
  @@index([productId])
  
  @@map("influencer_campaign_products")
}

model AffiliateProfile {
  id     String  @id @default(cuid())
  userId String  @unique
  
  // Business Info
  businessName String? @db.VarChar(255)
  website      String? @db.VarChar(500)
  
  // Commission
  commission     Float @default(5.0) @db.DoublePrecision
  totalEarned    Float @default(0) @db.DoublePrecision
  
  // Performance
  totalClicks    Int   @default(0)
  totalSales     Int   @default(0)
  conversionRate Float @default(0) @db.DoublePrecision
  
  // Verification
  isVerified Boolean   @default(false)
  verifiedAt DateTime? @db.Timestamptz(3)
  
  // Status
  isActive Boolean @default(true)
  tier     String  @default("BRONZE") @db.VarChar(50)
  
  // Payment Method
  paymentMethod Json? @db.JsonB
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user  User            @relation(fields: [userId], references: [id])
  links AffiliateLink[]

  @@index([userId])
  @@index([isVerified])
  @@index([tier])
  
  @@map("affiliate_profiles")
}

model AffiliateLink {
  id          String @id @default(cuid())
  affiliateId String
  code        String @unique @db.VarChar(100)
  
  // Details
  name      String? @db.VarChar(255)
  targetUrl String  @db.Text
  productId String? @db.VarChar(50)
  
  // Performance
  clicks      Int   @default(0)
  conversions Int   @default(0)
  revenue     Float @default(0) @db.DoublePrecision
  commission  Float @default(0) @db.DoublePrecision
  
  // Status
  isActive Boolean @default(true)
  
  // Expiry
  expiresAt DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  affiliate AffiliateProfile @relation(fields: [affiliateId], references: [id])

  @@index([affiliateId])
  @@index([code])
  @@index([productId])
  @@index([isActive])
  
  @@map("affiliate_links")
}// ============================================================================
// MYSTERY BOX MODELS
// ============================================================================

enum MysteryBoxRarity {
  COMMON
  UNCOMMON
  RARE
  EPIC
  LEGENDARY
  MYTHIC
}

model MysteryBox {
  id          String @id @default(cuid())
  name        String @db.VarChar(255)
  slug        String @unique @db.VarChar(255)
  description String? @db.Text
  
  // Visual
  image       String? @db.Text
  previewImage String? @db.Text
  unboxingAnimation String? @db.Text
  
  // Pricing
  price Float @db.DoublePrecision
  value Float @db.DoublePrecision // Total value of contents
  
  // Classification
  category String? @db.VarChar(100)
  theme    String? @db.VarChar(100)
  rarity   MysteryBoxRarity @default(COMMON)
  
  // Inventory
  stock     Int @default(0)
  soldCount Int @default(0)
  
  // Features
  guaranteedItems Int? // Minimum guaranteed items
  maxItems        Int? // Maximum possible items
  
  // Reveal
  revealDate DateTime? @db.Timestamptz(3)
  autoReveal Boolean   @default(false)
  
  // Status
  isActive   Boolean @default(true)
  isLimited  Boolean @default(false)
  isSeasonal Boolean @default(false)
  
  // Season
  seasonName  String? @db.VarChar(100)
  seasonStart DateTime? @db.Timestamptz(3)
  seasonEnd   DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  items     MysteryBoxItem[]
  purchases MysteryBoxPurchase[]

  @@index([slug])
  @@index([isActive])
  @@index([category])
  @@index([theme])
  @@index([rarity])
  @@index([soldCount(sort: Desc)])
  
  @@map("mystery_boxes")
}

model MysteryBoxItem {
  id    String @id @default(cuid())
  boxId String
  productId String
  
  // Quantity
  quantity Int @default(1)
  
  // Drop Rate
  probability Float @db.DoublePrecision // 0.0 to 1.0
  tier        String @default("COMMON") @db.VarChar(50)
  
  // Weighting
  weight Int @default(1)
  
  // Guaranteed
  isGuaranteed Boolean @default(false)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  box     MysteryBox @relation(fields: [boxId], references: [id], onDelete: Cascade)
  product Product    @relation(fields: [productId], references: [id])

  @@index([boxId])
  @@index([productId])
  @@index([tier])
  @@index([probability(sort: Desc)])
  
  @@map("mystery_box_items")
}

model MysteryBoxPurchase {
  id     String @id @default(cuid())
  userId String
  boxId  String
  orderId String? @db.VarChar(50)
  
  // Purchase Details
  price Float @db.DoublePrecision
  
  // Revealed Items
  revealedItems Json? @db.JsonB
  isRevealed    Boolean @default(false)
  revealedAt    DateTime? @db.Timestamptz(3)
  
  // Rarity of Items Received
  rarityBreakdown Json? @db.JsonB
  totalValue      Float? @db.DoublePrecision
  
  // User Reaction
  rating    Int? @db.SmallInt
  feedback  String? @db.Text
  
  // Sharing
  isShared  Boolean @default(false)
  sharedAt  DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user User       @relation(fields: [userId], references: [id])
  box  MysteryBox @relation(fields: [boxId], references: [id])

  @@index([userId])
  @@index([boxId])
  @@index([orderId])
  @@index([isRevealed])
  @@index([createdAt(sort: Desc)])
  
  @@map("mystery_box_purchases")
}

// ============================================================================
// TRADE-IN PROGRAM MODELS
// ============================================================================

enum TradeInStatus {
  PENDING
  UNDER_REVIEW
  APPROVED
  REJECTED
  DEVICE_RECEIVED
  INSPECTING
  COMPLETED
  CANCELLED
}

model TradeInProgram {
  id          String @id @default(cuid())
  name        String @db.VarChar(255)
  description String? @db.Text
  
  // Applicable Items
  categoryIds String[] @db.VarChar(50)
  brandIds    String[] @db.VarChar(50)
  
  // Terms
  minValue        Float? @db.DoublePrecision
  maxValue        Float? @db.DoublePrecision
  valuationMethod String @default("MANUAL") @db.VarChar(50) // MANUAL, AI, HYBRID
  
  // Bonus
  bonusPercentage Float @default(0) @db.DoublePrecision
  bonusConditions Json? @db.JsonB
  
  // Status
  isActive Boolean @default(true)
  
  // Terms & Conditions
  terms           String? @db.Text
  eligibilityCriteria Json? @db.JsonB
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  requests TradeInRequest[]

  @@index([isActive])
  @@index([name])
  
  @@map("trade_in_programs")
}

model TradeInRequest {
  id        String @id @default(cuid())
  programId String
  userId    String @db.VarChar(50)
  
  // Device Details
  productName String  @db.VarChar(500)
  brand       String  @db.VarChar(255)
  model       String? @db.VarChar(255)
  
  // Condition
  condition   String  @db.VarChar(100)
  ageInMonths Int?
  
  // Issues
  hasPhysicalDamage Boolean @default(false)
  hasFunctionalIssues Boolean @default(false)
  issueDescription  String? @db.Text
  
  // Media
  images      String[] @db.Text
  videos      String[] @db.Text
  
  // Self Assessment
  description String? @db.Text
  
  // Valuation
  estimatedValue Float? @db.DoublePrecision
  offeredValue   Float? @db.DoublePrecision
  acceptedValue  Float? @db.DoublePrecision
  finalValue     Float? @db.DoublePrecision
  
  // Status
  status TradeInStatus @default(PENDING)
  
  // Rejection
  rejectionReason String? @db.Text
  
  // Inspection
  inspectionNotes String? @db.Text
  inspectedBy     String? @db.VarChar(50)
  inspectedAt     DateTime? @db.Timestamptz(3)
  
  // Discrepancies
  hasDiscrepancies Boolean @default(false)
  discrepancyNotes String? @db.Text
  
  // Usage in Order
  usedInOrderId String? @db.VarChar(50)
  usedAt        DateTime? @db.Timestamptz(3)
  
  // Shipping
  shippingLabel   String? @db.Text
  trackingNumber  String? @db.VarChar(255)
  shippedAt       DateTime? @db.Timestamptz(3)
  receivedAt      DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  program TradeInProgram @relation(fields: [programId], references: [id])

  @@index([programId])
  @@index([userId])
  @@index([status])
  @@index([brand])
  @@index([createdAt(sort: Desc)])
  
  @@map("trade_in_requests")
}

// ============================================================================
// GROUP SHOPPING MODELS
// ============================================================================

enum GroupRole {
  CREATOR
  ADMIN
  MEMBER
}

model ShoppingGroup {
  id          String  @id @default(cuid())
  name        String  @db.VarChar(255)
  description String? @db.Text
  creatorId   String
  
  // Privacy
  isPublic Boolean @default(false)
  password String? @db.VarChar(255)
  
  // Limits
  maxMembers      Int? @default(10)
  currentMembers  Int  @default(1)
  
  // Invite Code
  code String @unique @db.VarChar(50)
  
  // Features
  allowInvites      Boolean @default(true)
  allowProductAdd   Boolean @default(true)
  requireApproval   Boolean @default(false)
  
  // Group Shopping Benefits
  groupDiscount     Float? @db.DoublePrecision
  freeShippingAt    Float? @db.DoublePrecision
  
  // Status
  isActive Boolean @default(true)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  creator  User                   @relation("GroupCreator", fields: [creatorId], references: [id])
  members  GroupMember[]
  sessions GroupShoppingSession[]

  @@index([creatorId])
  @@index([code])
  @@index([isActive])
  @@index([isPublic])
  
  @@map("shopping_groups")
}

model GroupMember {
  id      String    @id @default(cuid())
  groupId String
  userId  String
  role    GroupRole @default(MEMBER)
  
  // Invitation
  invitedBy String? @db.VarChar(50)
  
  // Participation
  totalPurchases Int   @default(0)
  totalSpent     Float @default(0) @db.DoublePrecision
  
  // Status
  isActive Boolean @default(true)
  
  // Timestamps
  joinedAt DateTime  @default(now()) @db.Timestamptz(3)
  leftAt   DateTime? @db.Timestamptz(3)
  
  // Relations
  group ShoppingGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user  User          @relation(fields: [userId], references: [id])

  @@unique([groupId, userId])
  @@index([groupId])
  @@index([userId])
  @@index([role])
  
  @@map("group_members")
}

model GroupShoppingSession {
  id          String @id @default(cuid())
  groupId     String
  productId   String @db.VarChar(50)
  initiatedBy String @db.VarChar(50)
  
  // Session Details
  targetQuantity Int @default(1)
  currentQuantity Int @default(0)
  
  // Pricing
  regularPrice Float  @db.DoublePrecision
  groupPrice   Float? @db.DoublePrecision
  savings      Float? @db.DoublePrecision
  
  // Status
  status String @default("ACTIVE") @db.VarChar(50) // ACTIVE, VOTING, COMPLETED, EXPIRED
  
  // Participants
  participants Json  @db.JsonB
  
  // Voting (if enabled)
  votes    Json? @db.JsonB
  decision String? @db.VarChar(50) // APPROVED, REJECTED
  
  // Completion
  orderId     String? @db.VarChar(50)
  completedAt DateTime? @db.Timestamptz(3)
  
  // Expiry
  expiresAt DateTime? @db.Timestamptz(3)
  
  // Timestamps
  startedAt DateTime  @default(now()) @db.Timestamptz(3)
  endedAt   DateTime? @db.Timestamptz(3)
  
  // Relations
  group ShoppingGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@index([groupId])
  @@index([productId])
  @@index([status])
  @@index([expiresAt])
  
  @@map("group_shopping_sessions")
}

// ============================================================================
// REGISTRY MODELS (Gift Registry, Wedding, Baby)
// ============================================================================

enum RegistryType {
  WEDDING
  BABY
  BIRTHDAY
  ANNIVERSARY
  HOUSEWARMING
  HOLIDAY
  GENERAL
}

enum RegistryPrivacy {
  PUBLIC
  PRIVATE
  PASSWORD_PROTECTED
}

model Registry {
  id           String @id @default(cuid())
  userId       String
  type         RegistryType
  
  // Details
  title        String  @db.VarChar(255)
  description  String? @db.Text
  
  // Event
  eventDate    DateTime? @db.Date
  eventLocation String? @db.VarChar(500)
  
  // Privacy
  privacyLevel RegistryPrivacy @default(PUBLIC)
  password     String? @db.VarChar(255)
  slug         String  @unique @db.VarChar(255)
  
  // Visual
  coverImage String? @db.Text
  theme      String? @db.VarChar(100)
  
  // Co-Registrants
  coRegistrants Json? @db.JsonB
  
  // Settings
  allowGroupGifting Boolean @default(true)
  showPurchased     Boolean @default(true)
  allowMessages     Boolean @default(true)
  
  // Status
  isActive Boolean @default(true)
  
  // Engagement
  viewCount Int @default(0)
  
  // Shipping
  shippingAddress Json? @db.JsonB
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user         User                   @relation(fields: [userId], references: [id])
  items        RegistryItem[]
  contributions RegistryContribution[]

  @@index([userId])
  @@index([slug])
  @@index([type])
  @@index([isActive])
  @@index([eventDate])
  
  @@map("registries")
}

model RegistryItem {
  id         String @id @default(cuid())
  registryId String
  productId  String @db.VarChar(50)
  
  // Product Info (denormalized)
  productName  String  @db.VarChar(500)
  productImage String? @db.Text
  productPrice Float   @db.DoublePrecision
  
  // Quantity
  quantity  Int @default(1)
  purchased Int @default(0)
  remaining Int @default(1)
  
  // Priority
  priority String @default("MEDIUM") @db.VarChar(50) // HIGH, MEDIUM, LOW
  
  // Notes
  notes String? @db.Text
  
  // Status
  isAvailable Boolean @default(true)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  registry Registry @relation(fields: [registryId], references: [id], onDelete: Cascade)

  @@index([registryId])
  @@index([productId])
  @@index([priority])
  
  @@map("registry_items")
}

model RegistryContribution {
  id               String @id @default(cuid())
  registryId       String
  contributorName  String @db.VarChar(255)
  contributorEmail String? @db.VarChar(255)
  contributorPhone String? @db.VarChar(20)
  
  // Gift Details
  productId String @db.VarChar(50)
  quantity  Int    @default(1)
  amount    Float  @db.DoublePrecision
  
  // Message
  message String? @db.Text
  
  // Order Reference
  orderId String? @db.VarChar(50)
  
  // Gift Wrapping
  isGiftWrapped Boolean @default(false)
  giftMessage   String? @db.Text
  
  // Anonymity
  isAnonymous Boolean @default(false)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  registry Registry @relation(fields: [registryId], references: [id])

  @@index([registryId])
  @@index([orderId])
  @@index([contributorEmail])
  
  @@map("registry_contributions")
}

// ============================================================================
// DISPUTE MODELS
// ============================================================================

enum DisputeStatus {
  OPEN
  UNDER_REVIEW
  AWAITING_RESPONSE
  ESCALATED
  RESOLVED
  CLOSED
  CANCELLED
}

enum DisputePriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

model Dispute {
  id      String @id @default(cuid())
  orderId String
  userId  String @db.VarChar(50)
  
  // Dispute Details
  type        String        @db.VarChar(100)
  subject     String        @db.VarChar(500)
  description String        @db.Text
  
  // Evidence
  evidence String[] @db.Text
  
  // Status
  status   DisputeStatus   @default(OPEN)
  priority DisputePriority @default(MEDIUM)
  
  // Assignment
  assignedTo String? @db.VarChar(50)
  assignedAt DateTime? @db.Timestamptz(3)
  
  // Resolution
  resolution   String? @db.Text
  resolvedAt   DateTime? @db.Timestamptz(3)
  resolvedBy   String? @db.VarChar(50)
  
  // Refund
  refundAmount Float? @db.DoublePrecision
  refundStatus String? @db.VarChar(50)
  
  // SLA
  responseDeadline   DateTime? @db.Timestamptz(3)
  resolutionDeadline DateTime? @db.Timestamptz(3)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  messages DisputeMessage[]

  @@index([orderId])
  @@index([userId])
  @@index([status])
  @@index([priority])
  @@index([assignedTo])
  @@index([createdAt(sort: Desc)])
  
  @@map("disputes")
}

model DisputeMessage {
  id        String @id @default(cuid())
  disputeId String
  senderId  String @db.VarChar(50)
  senderType String @db.VarChar(20) // USER, ADMIN, SYSTEM
  
  // Message
  message     String   @db.Text
  attachments String[] @db.Text
  
  // Visibility
  isInternal Boolean @default(false)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  dispute Dispute @relation(fields: [disputeId], references: [id], onDelete: Cascade)

  @@index([disputeId])
  @@index([senderId])
  @@index([createdAt(sort: Desc)])
  
  @@map("dispute_messages")
}

// ============================================================================
// CUSTOMIZATION REQUEST MODELS
// ============================================================================

enum CustomizationRequestStatus {
  PENDING
  UNDER_REVIEW
  QUOTED
  APPROVED
  IN_PRODUCTION
  COMPLETED
  REJECTED
  CANCELLED
}

model CustomizationRequest {
  id        String  @id @default(cuid())
  userId    String
  productId String? @db.VarChar(50)
  
  // Request Details
  type    String @db.VarChar(100)
  details String @db.Text
  
  // Media
  images       String[] @db.Text
  referenceImages String[] @db.Text
  
  // Budget & Timeline
  budget   Float? @db.DoublePrecision
  deadline DateTime? @db.Date
  
  // Status
  status CustomizationRequestStatus @default(PENDING)
  
  // Admin Response
  adminResponse String? @db.Text
  quotedPrice   Float?  @db.DoublePrecision
  estimatedTime Int?    // in days
  
  // Approval
  approvedAt DateTime? @db.Timestamptz(3)
  approvedBy String?   @db.VarChar(50)
  
  // Rejection
  rejectedAt     DateTime? @db.Timestamptz(3)
  rejectionReason String? @db.Text
  
  // Completion
  completedAt    DateTime? @db.Timestamptz(3)
  deliveryImages String[] @db.Text
  
  // Order Reference
  orderId String? @db.VarChar(50)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([productId])
  @@index([status])
  @@index([type])
  @@index([createdAt(sort: Desc)])
  
  @@map("customization_requests")
}

// ============================================================================
// SUSTAINABILITY MODELS
// ============================================================================

model CarbonOffset {
  id      String  @id @default(cuid())
  userId  String
  orderId String? @db.VarChar(50)
  
  // Offset Details
  amount   Float @db.DoublePrecision
  offsetKg Float @db.DoublePrecision
  
  // Certificate
  certificate     String? @db.Text
  certificateUrl  String? @db.Text
  certificateNumber String? @db.VarChar(100)
  
  // Provider
  provider    String? @db.VarChar(255)
  projectName String? @db.VarChar(500)
  projectType String? @db.VarChar(100)
  location    String? @db.VarChar(255)
  
  // Status
  status String @default("PENDING") @db.VarChar(50)
  
  // Verification
  verifiedAt   DateTime? @db.Timestamptz(3)
  verifiedBy   String?   @db.VarChar(50)
  
  // Retirement (making offset permanent)
  retiredAt DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([orderId])
  @@index([status])
  @@index([provider])
  
  @@map("carbon_offsets")
}

model SustainabilityScore {
  id     String @id @default(cuid())
  userId String @unique
  
  // Overall Score
  overallScore Float @default(0) @db.DoublePrecision
  
  // Metrics
  carbonSaved     Float @default(0) @db.DoublePrecision
  recycledItems   Int   @default(0)
  ecoProducts     Int   @default(0)
  offsetPurchases Int   @default(0)
  
  // Actions
  tradeInCount      Int @default(0)
  sustainableChoices Int @default(0)
  refurbishedPurchases Int @default(0)
  
  // Tier
  tier String @default("ECO_STARTER") @db.VarChar(50)
  
  // Badges
  badges String[] @db.VarChar(100)
  
  // Impact Statement
  treesPlanted      Float @default(0) @db.DoublePrecision
  plasticSaved      Float @default(0) @db.DoublePrecision
  waterConserved    Float @default(0) @db.DoublePrecision
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id])

  @@index([overallScore(sort: Desc)])
  @@index([tier])
  
  @@map("sustainability_scores")
}

// ============================================================================
// AVAILABILITY CALENDAR (for Rental/Booking)
// ============================================================================

model AvailabilityCalendar {
  id        String @id @default(cuid())
  productId String
  
  // Date
  date DateTime @db.Date
  
  // Availability
  available Int @default(0)
  booked    Int @default(0)
  blocked   Int @default(0)
  
  // Pricing (can vary by date)
  price       Float? @db.DoublePrecision
  priceWeekly Float? @db.DoublePrecision
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, date])
  @@index([productId])
  @@index([date])
  @@index([available])
  
  @@map("availability_calendar")
}

// ============================================================================
// PRICING STRATEGY MODELS
// ============================================================================

model PricingRule {
  id          String  @id @default(cuid())
  name        String  @db.VarChar(255)
  description String? @db.Text
  
  // Type
  type String @db.VarChar(100) // DYNAMIC, TIME_BASED, VOLUME, COMPETITOR
  
  // Conditions
  conditions Json @db.JsonB
  
  // Adjustments
  adjustments Json @db.JsonB
  
  // Priority
  priority Int @default(0)
  
  // Status
  isActive Boolean @default(true)
  
  // Validity
  validFrom  DateTime? @db.Timestamptz(3)
  validUntil DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([type])
  @@index([isActive])
  @@index([priority(sort: Desc)])
  @@index([validFrom, validUntil])
  
  @@map("pricing_rules")
}

model SurgePricing {
  id        String @id @default(cuid())
  productId String @db.VarChar(50)
  
  // Pricing
  basePrice    Float @db.DoublePrecision
  currentPrice Float @db.DoublePrecision
  multiplier   Float @db.DoublePrecision
  
  // Reason
  reason String? @db.VarChar(255)
  
  // Factors
  demand      Float? @db.DoublePrecision
  supply      Float? @db.DoublePrecision
  competitors Json?  @db.JsonB
  
  // Status
  isActive Boolean @default(true)
  
  // Validity
  effectiveFrom  DateTime  @db.Timestamptz(3)
  effectiveUntil DateTime? @db.Timestamptz(3)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([productId])
  @@index([isActive])
  @@index([effectiveFrom])
  
  @@map("surge_pricing")
}

model PriceHistory {
  id        String @id @default(cuid())
  productId String
  variantId String? @db.VarChar(50)
  
  // Pricing
  price        Float  @db.DoublePrecision
  comparePrice Float? @db.DoublePrecision
  
  // Change Details
  changeType    String  @db.VarChar(50) // INCREASE, DECREASE, PROMOTION, SURGE
  changePercent Float?  @db.DoublePrecision
  reason        String? @db.VarChar(255)
  
  // Effective Period
  effectiveFrom DateTime  @db.Timestamptz(3)
  effectiveTo   DateTime? @db.Timestamptz(3)
  
  // Who Made Change
  createdBy String? @db.VarChar(50)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([variantId])
  @@index([effectiveFrom])
  @@index([changeType])
  
  @@map("price_history")
}

// ============================================================================
// INVENTORY MANAGEMENT MODELS
// ============================================================================

enum StockMovementType {
  PURCHASE
  SALE
  RETURN
  ADJUSTMENT
  TRANSFER
  DAMAGE
  THEFT
  RESTOCK
  RESERVED
  RELEASED
}

model StockMovement {
  id        String @id @default(cuid())
  productId String
  variantId String? @db.VarChar(50)
  sku       String? @db.VarChar(100)
  
  // Movement Details
  type     StockMovementType
  quantity Int
  
  // Location
  from String? @db.VarChar(255)
  to   String? @db.VarChar(255)
  
  // Reference
  reference String? @db.VarChar(255)
  orderId   String? @db.VarChar(50)
  
  // Reason
  reason String? @db.Text
  notes  String? @db.Text
  
  // User
  userId String? @db.VarChar(50)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([variantId])
  @@index([type])
  @@index([orderId])
  @@index([createdAt(sort: Desc)])
  
  @@map("stock_movements")
}

model InventoryLog {
  id        String @id @default(cuid())
  productId String
  variantId String? @db.VarChar(50)
  sku       String? @db.VarChar(100)
  
  // Event
  type String @db.VarChar(100)
  
  // Quantity
  quantity    Int
  previousQty Int
  newQty      Int
  
  // Details
  reason    String? @db.VarChar(255)
  reference String? @db.VarChar(255)
  
  // User
  userId String? @db.VarChar(50)
  
  // Location
  location    String? @db.VarChar(255)
  warehouseId String? @db.VarChar(50)
  
  // Batch
  batchNumber String? @db.VarChar(100)
  expiryDate  DateTime? @db.Date
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([variantId])
  @@index([type])
  @@index([sku])
  @@index([warehouseId])
  @@index([createdAt(sort: Desc)])
  
  @@map("inventory_logs")
}

model Warehouse {
  id       String @id @default(cuid())
  name     String @db.VarChar(255)
  code     String @unique @db.VarChar(50)
  
  // Type
  type String @default("FULFILLMENT") @db.VarChar(50)
  
  // Address
  address Json @db.JsonB
  
  // Contact
  contactName  String? @db.VarChar(255)
  contactPhone String? @db.VarChar(20)
  contactEmail String? @db.VarChar(255)
  
  // Capacity
  capacity     Int? 
  currentStock Int? @default(0)
  
  // Status
  isActive  Boolean @default(true)
  isPrimary Boolean @default(false)
  
  // Coordinates
  coordinates Json? @db.JsonB
  
  // Operating Hours
  operatingHours Json? @db.JsonB
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  inventory WarehouseInventory[]

  @@index([code])
  @@index([isActive])
  @@index([isPrimary])
  
  @@map("warehouses")
}

model WarehouseInventory {
  id          String @id @default(cuid())
  warehouseId String
  productId   String
  variantId   String? @db.VarChar(50)
  sku         String  @db.VarChar(100)
  
  // Quantity
  quantity     Int @default(0)
  reserved     Int @default(0)
  available    Int @default(0)
  
  // Reorder
  reorderPoint Int  @default(10)
  reorderQty   Int? @default(50)
  maxStock     Int?
  
  // Location in Warehouse
  location String? @db.VarChar(255)
  zone     String? @db.VarChar(100)
  aisle    String? @db.VarChar(50)
  rack     String? @db.VarChar(50)
  bin      String? @db.VarChar(50)
  
  // Last Count
  lastCounted DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  warehouse Warehouse @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([warehouseId, productId, variantId])
  @@index([warehouseId])
  @@index([productId])
  @@index([sku])
  @@index([available])
  
  @@map("warehouse_inventory")
}// ============================================================================
// MOBILE & DESKTOP APP MODELS
// ============================================================================

enum DevicePlatform {
  IOS
  ANDROID
  WEB
  WINDOWS
  MACOS
  LINUX
}

model MobileDevice {
  id       String @id @default(cuid())
  userId   String
  deviceId String @unique @db.VarChar(255)
  
  // Device Info
  deviceName   String? @db.VarChar(255)
  platform     DevicePlatform
  osVersion    String? @db.VarChar(100)
  appVersion   String  @db.VarChar(50)
  manufacturer String? @db.VarChar(100)
  model        String? @db.VarChar(100)
  
  // Push Notifications
  pushToken    String? @db.Text
  pushEnabled  Boolean @default(true)
  
  // Biometrics
  biometricsEnabled Boolean @default(false)
  biometricType     String? @db.VarChar(50)
  
  // Status
  isActive   Boolean  @default(true)
  lastActive DateTime @default(now()) @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user          User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  crashReports  AppCrashReport[]

  @@index([userId])
  @@index([deviceId])
  @@index([platform])
  @@index([isActive])
  @@index([lastActive(sort: Desc)])
  
  @@map("mobile_devices")
}

model AppCrashReport {
  id       String @id @default(cuid())
  deviceId String
  userId   String? @db.VarChar(50)
  
  // App Info
  appVersion String          @db.VarChar(50)
  platform   DevicePlatform
  osVersion  String?         @db.VarChar(100)
  
  // Error Details
  error      String  @db.Text
  errorType  String? @db.VarChar(255)
  stackTrace String? @db.Text
  
  // Breadcrumbs (user actions before crash)
  breadcrumbs Json? @db.JsonB
  
  // Device State
  deviceInfo   Json @db.JsonB
  appState     Json? @db.JsonB
  memoryUsage  Int?  // in MB
  diskSpace    Int?  // in MB
  batteryLevel Float? @db.DoublePrecision
  networkType  String? @db.VarChar(50)
  
  // Resolution
  resolved   Boolean   @default(false)
  resolvedAt DateTime? @db.Timestamptz(3)
  resolvedBy String?   @db.VarChar(50)
  resolution String?   @db.Text
  
  // Grouping
  fingerprint  String? @db.VarChar(255)
  occurrences  Int     @default(1)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  device MobileDevice @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@index([deviceId])
  @@index([userId])
  @@index([errorType])
  @@index([resolved])
  @@index([fingerprint])
  @@index([createdAt(sort: Desc)])
  
  @@map("app_crash_reports")
}

model PushToken {
  id       String @id @default(cuid())
  userId   String
  deviceId String
  token    String @unique @db.Text
  
  // Platform
  platform    DevicePlatform
  environment String         @default("production") @db.VarChar(50)
  
  // Status
  isActive Boolean   @default(true)
  lastUsed DateTime? @db.Timestamptz(3)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([deviceId])
  @@index([platform])
  @@index([isActive])
  
  @@map("push_tokens")
}

model AppFeedback {
  id       String @id @default(cuid())
  userId   String? @db.VarChar(50)
  deviceId String
  
  // Feedback
  rating     Int     @db.SmallInt // 1-5
  comment    String? @db.Text
  category   String? @db.VarChar(100)
  screenshot String? @db.Text
  
  // App Info
  appVersion String          @db.VarChar(50)
  platform   DevicePlatform
  
  // Privacy
  isPublic Boolean @default(false)
  
  // Status
  status String @default("NEW") @db.VarChar(50)
  
  // Response
  respondedAt DateTime? @db.Timestamptz(3)
  response    String?   @db.Text
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  user User? @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([deviceId])
  @@index([rating])
  @@index([category])
  @@index([status])
  @@index([createdAt(sort: Desc)])
  
  @@map("app_feedback")
}

model DesktopAppSession {
  id         String @id @default(cuid())
  userId     String
  deviceId   String @db.VarChar(255)
  appVersion String @db.VarChar(50)
  
  // Platform
  platform  DevicePlatform
  osVersion String? @db.VarChar(100)
  
  // Status
  isOnline Boolean @default(true)
  
  // Sync
  lastSyncAt DateTime? @db.Timestamptz(3)
  
  // Settings
  settings Json? @db.JsonB
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([deviceId])
  @@index([platform])
  @@index([isOnline])
  
  @@map("desktop_app_sessions")
}

model OfflineQueue {
  id       String  @id @default(cuid())
  deviceId String  @db.VarChar(255)
  userId   String? @db.VarChar(50)
  
  // Action Details
  action   String @db.VarChar(100)
  entity   String? @db.VarChar(100)
  entityId String? @db.VarChar(50)
  payload  Json   @db.JsonB
  
  // Priority
  priority Int @default(5)
  
  // Sync Status
  synced   Boolean   @default(false)
  syncedAt DateTime? @db.Timestamptz(3)
  
  // Retry
  attempts Int     @default(0)
  maxAttempts Int  @default(3)
  error    String? @db.Text
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([deviceId])
  @@index([userId])
  @@index([synced])
  @@index([priority(sort: Desc)])
  @@index([createdAt])
  
  @@map("offline_queue")
}

model DesktopNotification {
  id       String @id @default(cuid())
  userId   String
  deviceId String @db.VarChar(255)
  
  // Notification
  title   String @db.VarChar(500)
  message String @db.Text
  type    String @db.VarChar(50)
  data    Json?  @db.JsonB
  
  // Delivery
  delivered   Boolean   @default(false)
  deliveredAt DateTime? @db.Timestamptz(3)
  
  // Read Status
  read   Boolean   @default(false)
  readAt DateTime? @db.Timestamptz(3)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([userId])
  @@index([deviceId])
  @@index([delivered])
  @@index([read])
  @@index([createdAt(sort: Desc)])
  
  @@map("desktop_notifications")
}

// ============================================================================
// BROWSER EXTENSION MODELS
// ============================================================================

model BrowserExtensionUser {
  id          String  @id @default(cuid())
  userId      String
  extensionId String  @unique @db.VarChar(255)
  
  // Status
  isActive Boolean @default(true)
  
  // Settings
  settings Json? @db.JsonB
  
  // Sync
  installedAt DateTime  @default(now()) @db.Timestamptz(3)
  lastSyncAt  DateTime? @db.Timestamptz(3)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  user       User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  activities ExtensionActivity[]

  @@index([userId])
  @@index([extensionId])
  @@index([isActive])
  
  @@map("browser_extension_users")
}

model ExtensionActivity {
  id          String @id @default(cuid())
  extensionId String
  
  // Activity
  activityType String  @db.VarChar(100)
  productId    String? @db.VarChar(50)
  url          String? @db.Text
  
  // Metadata
  metadata Json? @db.JsonB
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  extension BrowserExtensionUser @relation(fields: [extensionId], references: [id], onDelete: Cascade)

  @@index([extensionId])
  @@index([activityType])
  @@index([productId])
  @@index([createdAt(sort: Desc)])
  
  @@map("extension_activities")
}

model PriceTracker {
  id          String @id @default(cuid())
  extensionId String
  
  // Product
  productUrl   String @db.Text
  productName  String @db.VarChar(500)
  imageUrl     String? @db.Text
  
  // Price
  currentPrice Float @db.DoublePrecision
  targetPrice  Float @db.DoublePrecision
  lowestPrice  Float? @db.DoublePrecision
  highestPrice Float? @db.DoublePrecision
  
  // Tracking
  lastChecked DateTime  @default(now()) @db.Timestamptz(3)
  notified    Boolean   @default(false)
  notifiedAt  DateTime? @db.Timestamptz(3)
  
  // Status
  isActive Boolean @default(true)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([extensionId])
  @@index([productUrl])
  @@index([notified])
  @@index([isActive])
  @@index([lastChecked])
  
  @@map("price_trackers")
}

// ============================================================================
// AI & ML MODELS
// ============================================================================

enum ModelStatus {
  TRAINING
  READY
  DEPLOYING
  DEPLOYED
  DEPRECATED
  FAILED
}

model MLModel {
  id       String @id @default(cuid())
  name     String @db.VarChar(255)
  version  String @db.VarChar(50)
  
  // Model Details
  type      String @db.VarChar(100)
  algorithm String @db.VarChar(100)
  framework String? @db.VarChar(100)
  
  // Performance Metrics
  accuracy  Float? @db.DoublePrecision
  precision Float? @db.DoublePrecision
  recall    Float? @db.DoublePrecision
  f1Score   Float? @db.DoublePrecision
  
  // Status
  status ModelStatus @default(TRAINING)
  
  // Model Files
  modelPath String? @db.Text
  modelSize Int?    // in bytes
  
  // Configuration
  parameters  Json @db.JsonB
  hyperparams Json? @db.JsonB
  
  // Deployment
  trainedAt    DateTime? @db.Timestamptz(3)
  deployedAt   DateTime? @db.Timestamptz(3)
  deprecatedAt DateTime? @db.Timestamptz(3)
  
  // Owner
  createdBy String? @db.VarChar(50)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  predictions ModelPrediction[]
  metrics     ModelMetric[]

  @@unique([name, version])
  @@index([name])
  @@index([type])
  @@index([status])
  @@index([deployedAt])
  
  @@map("ml_models")
}

model ModelPrediction {
  id           String @id @default(cuid())
  modelId      String
  modelVersion String @db.VarChar(50)
  
  // Input/Output
  input      Json  @db.JsonB
  output     Json  @db.JsonB
  confidence Float? @db.DoublePrecision
  
  // Performance
  latency Int? // in milliseconds
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  model MLModel @relation(fields: [modelId], references: [id])

  @@index([modelId])
  @@index([modelVersion])
  @@index([createdAt(sort: Desc)])
  
  @@map("model_predictions")
}

model ModelMetric {
  id         String @id @default(cuid())
  modelId    String
  metricName String @db.VarChar(100)
  value      Float  @db.DoublePrecision
  
  // Metadata
  metadata  Json?    @db.JsonB
  timestamp DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  model MLModel @relation(fields: [modelId], references: [id])

  @@index([modelId])
  @@index([metricName])
  @@index([timestamp(sort: Desc)])
  
  @@map("model_metrics")
}

model TrainingJob {
  id         String @id @default(cuid())
  modelId    String @db.VarChar(50)
  datasetId  String @db.VarChar(50)
  
  // Status
  status String @default("PENDING") @db.VarChar(50)
  
  // Training Configuration
  epochs       Int
  batchSize    Int
  learningRate Float @db.DoublePrecision
  optimizer    String? @db.VarChar(100)
  lossFunction String? @db.VarChar(100)
  
  // Progress
  progress     Int @default(0)
  currentEpoch Int @default(0)
  
  // Timing
  startedAt   DateTime? @db.Timestamptz(3)
  completedAt DateTime? @db.Timestamptz(3)
  
  // Results
  metrics Json? @db.JsonB
  logs    String? @db.Text
  error   String? @db.Text
  
  // Owner
  createdBy String? @db.VarChar(50)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([modelId])
  @@index([datasetId])
  @@index([status])
  @@index([createdAt(sort: Desc)])
  
  @@map("training_jobs")
}

model Dataset {
  id          String @id @default(cuid())
  name        String @db.VarChar(255)
  description String? @db.Text
  
  // Dataset Details
  type        String @db.VarChar(100)
  size        Int    // in bytes
  recordCount Int
  
  // Files
  filePath String @db.Text
  
  // Schema
  schema  Json     @db.JsonB
  version String   @db.VarChar(50)
  tags    String[] @db.VarChar(100)
  
  // Visibility
  isPublic Boolean @default(false)
  
  // Owner
  createdBy String? @db.VarChar(50)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([name])
  @@index([type])
  @@index([isPublic])
  @@index([tags])
  
  @@map("datasets")
}

model FeatureEngineering {
  id        String @id @default(cuid())
  datasetId String @db.VarChar(50)
  
  // Feature Details
  featureName String @db.VarChar(255)
  featureType String @db.VarChar(100)
  transform   String @db.VarChar(100)
  
  // Configuration
  parameters Json? @db.JsonB
  
  // Importance
  importance Float? @db.DoublePrecision
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([datasetId])
  @@index([featureName])
  @@index([importance(sort: Desc)])
  
  @@map("feature_engineering")
}

model ModelDeployment {
  id          String @id @default(cuid())
  modelId     String @db.VarChar(50)
  environment String @db.VarChar(50)
  
  // Deployment Details
  endpoint String @db.Text
  status   String @default("DEPLOYING") @db.VarChar(50)
  
  // Resources
  replicas  Int   @default(1)
  resources Json? @db.JsonB
  
  // Deployment
  deployedBy   String?   @db.VarChar(50)
  deployedAt   DateTime? @db.Timestamptz(3)
  undeployedAt DateTime? @db.Timestamptz(3)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([modelId])
  @@index([environment])
  @@index([status])
  
  @@map("model_deployments")
}

model AIRecommendation {
  id        String @id @default(cuid())
  userId    String @db.VarChar(50)
  algorithm String @db.VarChar(100)
  
  // Recommendations
  productIds String[] @db.VarChar(50)
  score      Float    @db.DoublePrecision
  
  // Context
  reason  String? @db.VarChar(255)
  context Json?   @db.JsonB
  
  // User Interaction
  displayed Boolean @default(false)
  clicked   Boolean @default(false)
  purchased Boolean @default(false)
  
  // Feedback
  feedback String? @db.VarChar(50)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([userId])
  @@index([algorithm])
  @@index([displayed])
  @@index([clicked])
  @@index([purchased])
  
  @@map("ai_recommendations")
}
model PersonalShopperSession {
  id        String   @id @default(cuid())
  userId    String   @db.VarChar(50)
  
  // Session Details
  sessionData Json?      @db.JsonB
  startedAt   DateTime   @default(now()) @db.Timestamptz(3)
  endedAt     DateTime?  @db.Timestamptz(3)
  
  // Status & Notes
  status      String?    @db.VarChar(50)
  notes       String?    @db.Text
  
  @@index([userId])
  
  @@map("personal_shopper_sessions")
}


model ChatbotConversation {
  id        String  @id @default(cuid())
  userId    String? @db.VarChar(50)
  sessionId String  @db.VarChar(255)
  
  // Messages
  messages Json[] @db.JsonB
  
  // Intent
  intent String? @db.VarChar(100)
  
  // Resolution
  resolved     Boolean @default(false)
  satisfaction Int?    @db.SmallInt
  
  // Escalation
  escalated   Boolean @default(false)
  escalatedTo String? @db.VarChar(50)
  
  // Metadata
  metadata Json? @db.JsonB
  
  // Timing
  startedAt DateTime  @default(now()) @db.Timestamptz(3)
  endedAt   DateTime? @db.Timestamptz(3)

  @@index([userId])
  @@index([sessionId])
  @@index([resolved])
  @@index([escalated])
  @@index([startedAt(sort: Desc)])
  
  @@map("chatbot_conversations")
}

model PredictionLog {
  id         String @id @default(cuid())
  modelType  String @db.VarChar(100)
  
  // Prediction
  input      Json  @db.JsonB
  prediction Json  @db.JsonB
  confidence Float? @db.DoublePrecision
  
  // Actual (for training)
  actual   Json?  @db.JsonB
  accuracy Float? @db.DoublePrecision
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([modelType])
  @@index([createdAt(sort: Desc)])
  
  @@map("prediction_logs")
}

model ImageRecognition {
  id       String  @id @default(cuid())
  userId   String? @db.VarChar(50)
  imageUrl String  @db.Text
  
  // Detection Results
  detectedObjects Json[] @db.JsonB
  similarProducts String[] @db.VarChar(50)
  tags            String[] @db.VarChar(100)
  
  // Confidence
  confidence Float @db.DoublePrecision
  
  // Performance
  processingTime Int // milliseconds
  
  // Model
  modelVersion String? @db.VarChar(50)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([userId])
  @@index([tags])
  @@index([createdAt(sort: Desc)])
  
  @@map("image_recognitions")
}

model SentimentAnalysis {
  id        String  @id @default(cuid())
  reviewId  String? @db.VarChar(50)
  commentId String? @db.VarChar(50)
  productId String? @db.VarChar(50)
  text      String  @db.Text
  
  // Sentiment
  sentiment String  @db.VarChar(20) // POSITIVE, NEGATIVE, NEUTRAL
  score     Float   @db.DoublePrecision
  magnitude Float?  @db.DoublePrecision
  
  // Emotions
  emotions Json? @db.JsonB
  
  // Keywords
  keywords String[] @db.VarChar(100)
  
  // Language
  language String @default("en") @db.VarChar(10)
  
  // Model
  modelVersion String? @db.VarChar(50)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([reviewId])
  @@index([commentId])
  @@index([productId])
  @@index([sentiment])
  @@index([createdAt(sort: Desc)])
  
  @@map("sentiment_analysis")
}

model ProductTagging {
  id        String @id @default(cuid())
  productId String
  
  // Tags
  tags       String[] @db.VarChar(100)
  confidence Json     @db.JsonB
  
  // Method
  method       String  @default("AI") @db.VarChar(50) // AI, MANUAL, HYBRID
  modelVersion String? @db.VarChar(50)
  
  // Verification
  verified   Boolean   @default(false)
  verifiedBy String?   @db.VarChar(50)
  verifiedAt DateTime? @db.Timestamptz(3)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([productId])
  @@index([method])
  @@index([verified])
  @@index([tags])
  
  @@map("product_tagging")
}

model FraudDetection {
  id            String  @id @default(cuid())
  orderId       String? @db.VarChar(50)
  userId        String? @db.VarChar(50)
  transactionId String? @db.VarChar(255)
  
  // Risk Assessment
  riskScore Float  @db.DoublePrecision
  riskLevel String @db.VarChar(20) // LOW, MEDIUM, HIGH, CRITICAL
  
  // Factors
  factors Json @db.JsonB
  rules   Json? @db.JsonB
  
  // Decision
  decision String @db.VarChar(50) // APPROVED, FLAGGED, BLOCKED
  
  // Review
  reviewed   Boolean   @default(false)
  reviewedBy String?   @db.VarChar(50)
  reviewedAt DateTime? @db.Timestamptz(3)
  notes      String?   @db.Text
  
  // False Positive
  falsePositive Boolean? 
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([orderId])
  @@index([userId])
  @@index([transactionId])
  @@index([riskLevel])
  @@index([decision])
  @@index([reviewed])
  
  @@map("fraud_detections")
}

model SearchRelevance {
  id        String @id @default(cuid())
  query     String @db.VarChar(500)
  productId String @db.VarChar(50)
  
  // Position
  position Int
  
  // User Action
  clicked   Boolean @default(false)
  purchased Boolean @default(false)
  
  // Score
  relevanceScore Float   @db.DoublePrecision
  algorithm      String? @db.VarChar(100)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([query])
  @@index([productId])
  @@index([clicked])
  @@index([purchased])
  @@index([relevanceScore(sort: Desc)])
  
  @@map("search_relevance")
}

// ============================================================================
// SYSTEM & CONFIGURATION MODELS
// ============================================================================

model Setting {
  id       String @id @default(cuid())
  key      String @unique @db.VarChar(255)
  value    Json   @db.JsonB
  
  // Metadata
  type        String?  @db.VarChar(50)
  category    String?  @db.VarChar(100)
  description String?  @db.Text
  
  // Visibility
  isPublic   Boolean @default(false)
  isEditable Boolean @default(true)
  
  // Validation
  validation Json? @db.JsonB
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([key])
  @@index([category])
  @@index([isPublic])
  
  @@map("settings")
}

model ActivityLog {
  id       String  @id @default(cuid())
  userId   String? @db.VarChar(50)
  userType String? @db.VarChar(50)
  
  // Action
  action String @db.VarChar(255)
  entity String? @db.VarChar(100)
  entityId String? @db.VarChar(50)
  
  // Changes
  changes Json? @db.JsonB
  
  // Context
  ipAddress String? @db.VarChar(45)
  userAgent String? @db.Text
  location  String? @db.VarChar(255)
  
  // Severity
  severity String @default("INFO") @db.VarChar(20)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([userId])
  @@index([action])
  @@index([entity, entityId])
  @@index([severity])
  @@index([createdAt(sort: Desc)])
  
  @@map("activity_logs")
}

model EmailTemplate {
  id       String @id @default(cuid())
  name     String @unique @db.VarChar(255)
  slug     String @unique @db.VarChar(255)
  
  // Content
  subject  String @db.VarChar(500)
  body     String @db.Text
  htmlBody String @db.Text
  
  // Variables
  variables String[] @db.VarChar(100)
  
  // Classification
  category String? @db.VarChar(100)
  language String  @default("en") @db.VarChar(10)
  
  // Status
  isActive  Boolean @default(true)
  isDefault Boolean @default(false)
  
  // Preview
  previewText String? @db.VarChar(255)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([name])
  @@index([slug])
  @@index([category])
  @@index([isActive])
  
  @@map("email_templates")
}

model APIKey {
  id          String @id @default(cuid())
  name        String @db.VarChar(255)
  key         String @unique @db.VarChar(500)
  secret      String @db.VarChar(500)
  userId      String? @db.VarChar(50)
  
  // Permissions
  permissions String[] @db.VarChar(100)
  
  // Rate Limiting
  rateLimit  Int @default(1000)
  usageCount Int @default(0)
  
  // Usage
  lastUsedAt DateTime? @db.Timestamptz(3)
  
  // Expiry
  expiresAt DateTime? @db.Timestamptz(3)
  
  // Status
  isActive Boolean @default(true)
  
  // Security
  ipWhitelist String[] @db.VarChar(45)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([key])
  @@index([userId])
  @@index([isActive])
  @@index([expiresAt])
  
  @@map("api_keys")
}

model FeatureFlag {
  id          String @id @default(cuid())
  name        String @unique @db.VarChar(255)
  key         String @unique @db.VarChar(255)
  description String? @db.Text
  
  // Status
  isEnabled Boolean @default(false)
  
  // Rollout
  rolloutPercentage Int @default(0)
  
  // Targeting
  targetUsers    String[] @db.VarChar(50)
  targetSegments String[] @db.VarChar(100)
  
  // Conditions
  conditions Json? @db.JsonB
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([key])
  @@index([isEnabled])
  
  @@map("feature_flags")
}

model RateLimit {
  id         String @id @default(cuid())
  identifier String @db.VarChar(255)
  action     String @db.VarChar(100)
  
  // Limit
  count  Int @default(1)
  limit  Int
  window Int // in seconds
  
  // Expiry
  expiresAt DateTime @db.Timestamptz(3)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@unique([identifier, action])
  @@index([identifier])
  @@index([action])
  @@index([expiresAt])
  
  @@map("rate_limits")
}

model SystemMetric {
  id     String @id @default(cuid())
  metric String @db.VarChar(255)
  value  Float  @db.DoublePrecision
  
  // Unit
  unit String? @db.VarChar(50)
  
  // Tags
  tags Json? @db.JsonB
  
  // Timestamp
  timestamp DateTime @default(now()) @db.Timestamptz(3)
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([metric])
  @@index([timestamp(sort: Desc)])
  
  @@map("system_metrics")
}

model ErrorLog {
  id        String  @id @default(cuid())
  level     String  @default("ERROR") @db.VarChar(20)
  message   String  @db.Text
  stack     String? @db.Text
  code      String? @db.VarChar(100)
  
  // Context
  context   Json?   @db.JsonB
  userId    String? @db.VarChar(50)
  sessionId String? @db.VarChar(255)
  url       String? @db.Text
  method    String? @db.VarChar(20)
  ipAddress String? @db.VarChar(45)
  userAgent String? @db.Text
  
  // Resolution
  resolved   Boolean   @default(false)
  resolvedAt DateTime? @db.Timestamptz(3)
  resolvedBy String?   @db.VarChar(50)
  
  // Grouping
  fingerprint String? @db.VarChar(255)
  occurrences Int     @default(1)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([level])
  @@index([resolved])
  @@index([fingerprint])
  @@index([userId])
  @@index([createdAt(sort: Desc)])
  
  @@map("error_logs")
}

model BackgroundJob {
  id       String @id @default(cuid())
  type     String @db.VarChar(100)
  name     String @db.VarChar(255)
  
  // Payload
  payload Json? @db.JsonB
  
  // Status
  status   String @default("PENDING") @db.VarChar(50)
  priority Int    @default(5)
  
  // Execution
  attempts    Int @default(0)
  maxAttempts Int @default(3)
  
  // Progress
  progress Int @default(0)
  
  // Result
  result Json?   @db.JsonB
  error  String? @db.Text
  
  // Timing
  startedAt   DateTime? @db.Timestamptz(3)
  completedAt DateTime? @db.Timestamptz(3)
  failedAt    DateTime? @db.Timestamptz(3)
  
  // Scheduling
  scheduledFor DateTime? @db.Timestamptz(3)
  timeout      Int?      // in seconds
  
  // Owner
  createdBy String? @db.VarChar(50)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([type])
  @@index([status])
  @@index([scheduledFor])
  @@index([priority(sort: Desc)])
  @@index([createdAt(sort: Desc)])
  
  @@map("background_jobs")
}

model WebhookLog {
  id       String @id @default(cuid())
  event    String @db.VarChar(100)
  provider String @db.VarChar(100)
  
  // Request
  url     String @db.Text
  method  String @default("POST") @db.VarChar(10)
  headers Json?  @db.JsonB
  payload Json   @db.JsonB
  
  // Response
  response   Json?   @db.JsonB
  statusCode Int?
  success    Boolean @default(false)
  
  // Retry
  attempts Int     @default(1)
  error    String? @db.Text
  
  // Processing
  processedAt DateTime? @db.Timestamptz(3)
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([event])
  @@index([provider])
  @@index([success])
  @@index([createdAt(sort: Desc)])
  
  @@map("webhook_logs")
}

// ============================================================================
// CONTENT MANAGEMENT MODELS
// ============================================================================

enum ContentStatus {
  DRAFT
  PUBLISHED
  SCHEDULED
  ARCHIVED
}

model ContentPage {
  id       String @id @default(cuid())
  title    String @db.VarChar(500)
  slug     String @unique @db.VarChar(500)
  content  String @db.Text
  excerpt  String? @db.VarChar(1000)
  
  // Template
  template String? @db.VarChar(100)
  
  // Author
  author     String   @db.VarChar(50)
  coAuthors  String[] @db.VarChar(50)
  
  // Status
  status ContentStatus @default(DRAFT)
  
  // Publishing
  publishedAt  DateTime? @db.Timestamptz(3)
  scheduledFor DateTime? @db.Timestamptz(3)
  
  // SEO
  seoTitle       String?  @db.VarChar(255)
  seoDescription String?  @db.Text
  seoKeywords    String[] @db.VarChar(100)
  
  // Media
  featuredImage String? @db.Text
  ogImage       String? @db.Text
  
  // Canonical
  canonicalUrl String? @db.VarChar(500)
  
  // Engagement
  viewCount  Int @default(0)
  shareCount Int @default(0)
  
  // Localization
  locale       String @default("en") @db.VarChar(10)
  translations Json?  @db.JsonB
  
  // Custom Fields
  customFields Json? @db.JsonB
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([slug])
  @@index([status])
  @@index([author])
  @@index([publishedAt])
  @@fulltext([title, content])
  
  @@map("content_pages")
}

model BlogPost {
  id       String @id @default(cuid())
  title    String @db.VarChar(500)
  slug     String @unique @db.VarChar(500)
  content  String @db.Text
  excerpt  String? @db.VarChar(1000)
  
  // Author
  authorId   String  @db.VarChar(50)
  categoryId String? @db.VarChar(50)
  
  // Tags
  tags String[] @db.VarChar(100)
  
  // Media
  featuredImage String?  @db.Text
  gallery       String[] @db.Text
  
  // Status
  status ContentStatus @default(DRAFT)
  
  // Publishing
  publishedAt  DateTime? @db.Timestamptz(3)
  scheduledFor DateTime? @db.Timestamptz(3)
  
  // SEO
  seoTitle       String? @db.VarChar(255)
  seoDescription String? @db.Text
  
  // Engagement
  viewCount    Int @default(0)
  likeCount    Int @default(0)
  commentCount Int @default(0)
  shareCount   Int @default(0)
  
  // Reading
  readTime Int? // in minutes
  
  // Features
  isFeatured    Boolean @default(false)
  isPinned      Boolean @default(false)
  allowComments Boolean @default(true)
  
  // Related
  relatedPosts String[] @db.VarChar(50)
  
  // Custom Fields
  customFields Json? @db.JsonB
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  comments BlogComment[]

  @@index([slug])
  @@index([authorId])
  @@index([categoryId])
  @@index([status])
  @@index([publishedAt])
  @@index([isFeatured])
  @@fulltext([title, content])
  
  @@map("blog_posts")
}

model BlogComment {
  id     String @id @default(cuid())
  postId String
  userId String? @db.VarChar(50)
  
  // Author Info (for guests)
  authorName  String  @db.VarChar(255)
  authorEmail String  @db.VarChar(255)
  authorUrl   String? @db.VarChar(500)
  
  // Content
  content String @db.Text
  
  // Status
  isApproved Boolean @default(false)
  isSpam     Boolean @default(false)
  
  // Hierarchy
  parentId String? @db.VarChar(50)
  
  // Engagement
  likeCount   Int @default(0)
  reportCount Int @default(0)
  
  // Device
  ipAddress String? @db.VarChar(45)
  userAgent String? @db.Text
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  post    BlogPost      @relation(fields: [postId], references: [id], onDelete: Cascade)
  user    User?         @relation(fields: [userId], references: [id])
  parent  BlogComment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies BlogComment[] @relation("CommentReplies")

  @@index([postId])
  @@index([userId])
  @@index([parentId])
  @@index([isApproved])
  @@index([createdAt(sort: Desc)])
  
  @@map("blog_comments")
}

model VideoContent {
  id          String  @id @default(cuid())
  title       String  @db.VarChar(500)
  description String? @db.Text
  
  // Video Details
  videoUrl   String  @db.Text
  thumbnail  String? @db.Text
  duration   Int?    // in seconds
  resolution String? @db.VarChar(20)
  format     String? @db.VarChar(20)
  fileSize   Int?    // in bytes
  
  // Products
  productIds String[] @db.VarChar(50)
  categoryId String?  @db.VarChar(50)
  
  // Tags
  tags String[] @db.VarChar(100)
  
  // Engagement
  viewCount  Int @default(0)
  likeCount  Int @default(0)
  shareCount Int @default(0)
  
  // Shoppable
  isShoppable Boolean @default(false)
  timestamps  Json?   @db.JsonB // Product appearance timestamps
  
  // Captions & Transcription
  captions      Json?   @db.JsonB
  transcription String? @db.Text
  
  // Status
  status String @default("PROCESSING") @db.VarChar(50)
  
  // Owner
  createdBy String? @db.VarChar(50)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)
  
  // Relations
  products VideoContentProduct[]

  @@index([isShoppable])
  @@index([status])
  @@index([categoryId])
  @@index([createdAt(sort: Desc)])
  @@fulltext([title, description])
  
  @@map("video_contents")
}

model VideoContentProduct {
  id      String @id @default(cuid())
  videoId String
  productId String
  
  // Timestamp in video
  startTime Int? // seconds
  endTime   Int? // seconds
  
  // Position
  position Json? @db.JsonB
  
  // Timestamp
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  
  // Relations
  video   VideoContent @relation(fields: [videoId], references: [id], onDelete: Cascade)
  product Product      @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([videoId, productId])
  @@index([videoId])
  @@index([productId])
  
  @@map("video_content_products")
}

model MediaLibrary {
  id           String @id @default(cuid())
  fileName     String @db.VarChar(500)
  originalName String @db.VarChar(500)
  
  // File Details
  fileType String @db.VarChar(100)
  mimeType String @db.VarChar(100)
  fileSize Int    // in bytes
  
  // URLs
  url          String  @db.Text
  thumbnailUrl String? @db.Text
  
  // Dimensions (for images/videos)
  width  Int? 
  height Int?
  
  // Metadata
  alt     String? @db.VarChar(500)
  caption String? @db.Text
  
  // Organization
  folder String?  @db.VarChar(255)
  tags   String[] @db.VarChar(100)
  
  // Upload Info
  uploadedBy String  @db.VarChar(50)
  isPublic   Boolean @default(true)
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)

  @@index([fileType])
  @@index([folder])
  @@index([uploadedBy])
  @@index([tags])
  @@index([createdAt(sort: Desc)])
  
  @@map("media_library")
}

model ContactMessage {
  id      String @id @default(cuid())
  name    String @db.VarChar(255)
  email   String @db.VarChar(255)
  phone   String? @db.VarChar(20)
  subject String  @db.VarChar(500)
  message String  @db.Text
  
  // Classification
  category String? @db.VarChar(100)
  priority String  @default("NORMAL") @db.VarChar(50)
  
  // Status
  status MessageStatus @default(PENDING)
  
  // Assignment
  assignedTo String? @db.VarChar(50)
  
  // Reply
  repliedAt DateTime? @db.Timestamptz(3)
  repliedBy String?   @db.VarChar(50)
  replyText String?   @db.Text
  
  // Attachments
  attachments String[] @db.Text
  
  // Device
  ipAddress String? @db.VarChar(45)
  userAgent String? @db.Text
  
  // Metadata
  metadata  Json?    @db.JsonB
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([email])
  @@index([status])
  @@index([category])
  @@index([priority])
  @@index([createdAt(sort: Desc)])
  
  @@map("contact_messages")
}

enum MessageStatus {
  PENDING
  IN_PROGRESS
  RESOLVED
  CLOSED
  SPAM
}

model FAQ {
  id       String @id @default(cuid())
  question String @db.Text
  answer   String @db.Text
  
  // Classification
  category String?  @db.VarChar(100)
  tags     String[] @db.VarChar(100)
  
  // Display
  order      Int     @default(0)
  isActive   Boolean @default(true)
  isFeatured Boolean @default(false)
  
  // Engagement
  viewCount    Int @default(0)
  helpfulCount Int @default(0)
  
  // Language
  language String @default("en") @db.VarChar(10)
  
  // Timestamps
  createdAt DateTime @default(now()) @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @db.Timestamptz(3)

  @@index([category])
  @@index([isActive])
  @@index([isFeatured])
  @@index([order])
  @@fulltext([question, answer])
  
  @@map("faqs")
}

model Newsletter {
  id               String  @id @default(cuid())
  email            String  @unique @db.VarChar(255)
  name             String? @db.VarChar(255)
  phone            String? @db.VarChar(20)
  
  // Subscription
  isSubscribed Boolean @default(true)
  
  // Source
  source String? @db.VarChar(100)
  
  // Preferences
  preferences Json? @db.JsonB
  segments    String[] @db.VarChar(100)
  interests   String[] @db.VarChar(100)
  
  // Settings
  language  String @default("en") @db.VarChar(10)
  frequency String @default("WEEKLY") @db.VarChar(50)
  
  // Dates
  subscribedAt   DateTime  @default(now()) @db.Timestamptz(3)
  unsubscribedAt DateTime? @db.Timestamptz(3)
  
  // Unsubscribe
  unsubscribeReason String? @db.Text
  
  // Device
  ipAddress String? @db.VarChar(45)
  
  // Metadata
  metadata Json? @db.JsonB

  @@index([email])
  @@index([isSubscribed])
  @@index([segments])
  
  @@map("newsletters")
}